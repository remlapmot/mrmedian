-------------------------------------------------------------------------------
      name:  master
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\master.log
  log type:  text
 opened on:  27 Jun 2020, 22:56:57

. 
. cscript master
-------------------------------------------------------------------BEGIN master

. 
. cap noi ado describe mrrobust

. 
. local cscripts ///
> mrmvegger ///
> mrmvivw ///
> mr ///
> mrdeps ///
> mregger ///
> mreggerplot ///
> mreggersimex ///
> mrforest ///
> mrfunnel ///
> mrivests ///
> mrmedian ///
> mrmedianobs ///
> mrmodal ///
> mrmodalplot ///
> mrratio

. 
. foreach dofile of local cscripts {
  2.     log using `dofile'.log, text replace name(`dofile')
  3.     do `dofile'
  4.     log close `dofile'
  5. }
-------------------------------------------------------------------------------
      name:  mrmvegger
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmvegger.log
  log type:  text
 opened on:  27 Jun 2020, 22:56:57

. * mrmvegger cscript
. * 22un2020
. 
. cscript mrmvegger adofiles mrmvegger
----------------------------------------------------------------BEGIN mrmvegger

-> which mrmvegger, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmvegger.ado
*! version 0.1.0 23jun2020 Tom Palmer

. 
. * load in dataset
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. * ldlc - analysis 1
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. * check univariate estimate
. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. 
. * check univariate
. 
. discard

. mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. 
. mat b = e(b)

. mat V = e(V)

. assert b[1,1] - .617 < 1e-3

. assert b[1,2] - -.008 < 1e-3

. assert sqrt(V[1,1]) - .103 < 1e-3

. assert sqrt(V[2,2]) - .0054 < 1e-3

. 
. * check bivariate
. 
. discard

. mrmvegger chdbeta ldlcbeta hdlcbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .5723867   .1029385     5.56   0.000     .3706308    .7741425
    hdlcbeta |  -.2665853   .1226013    -2.17   0.030    -.5068793   -.0262912
       _cons |  -.0067173   .0054255    -1.24   0.216    -.0173511    .0039165
------------------------------------------------------------------------------

. 
. assert _b[ldlcbeta] - .572 < 1e-3

. assert _b[hdlcbeta] - -.267 < 1e-3

. assert _b[_cons] - -.007 < 1e-3

. assert _se[ldlcbeta] - .103 < 1e-3

. assert _se[hdlcbeta] - .123 < 1e-3

. assert _se[_cons] - .005 < 1e-3

. 
. * check r(table)
. mat list r(table)

r(table)[9,3]
           chdbeta:    chdbeta:    chdbeta:
          ldlcbeta    hdlcbeta       _cons
     b   .57238665  -.26658525  -.00671733
    se   .10293855   .12260126   .00542552
     z   5.5604696  -2.1744087  -1.2380993
pvalue   2.690e-08   .02967445   .21567925
    ll   .37063081   -.5068793  -.01735114
    ul    .7741425   -.0262912   .00391649
    df           .           .           .
  crit    1.959964    1.959964    1.959964
 eform           0           0           0

. 
. discard

. mrmvegger chdbeta ldlcbeta hdlcbeta [aw=1/(chdse^2)] if sel1==1, orient(2)

                                       MVMR-Egger model oriented wrt: hdlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4669652   .0585997     7.97   0.000     .3521119    .5818185
    hdlcbeta |  -.3045624   .1451187    -2.10   0.036    -.5889898    -.020135
       _cons |   .0005409   .0036762     0.15   0.883    -.0066642    .0077461
------------------------------------------------------------------------------

. 
. assert _b[ldlcbeta] - .467 < 1e-3

. assert _b[hdlcbeta] - -.305 < 1e-3

. assert _b[_cons] - .001 < 1e-3

. assert _se[ldlcbeta] - .059 < 1e-3

. assert _se[hdlcbeta] - .145 < 1e-3

. assert _se[_cons] - .004 < 1e-3

. 
. * check trivariate
. 
. discard

. mrmvegger chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .5672993   .1002611     5.66   0.000      .370791    .7638075
    hdlcbeta |  -.1364113   .1332727    -1.02   0.306    -.3976209    .1247983
      tgbeta |   .2739803   .1246927     2.20   0.028     .0295871    .5183735
       _cons |  -.0093655   .0054187    -1.73   0.084     -.019986     .001255
------------------------------------------------------------------------------

. 
. assert _b[ldlcbeta] - .567 < 1e-3

. assert _b[hdlcbeta] - -.136 < 1e-3

. assert _b[tgbeta] - .273 < 1e-3

. assert _b[_cons] - -.009 < 1e-3

. assert _se[ldlcbeta] - .100 < 1e-3

. assert _se[hdlcbeta] - .133 < 1e-3

. assert _se[tgbeta] - .124 < 1e-3

. assert _se[_cons] - .005 < 1e-3

. 
. * check orient option
. discard

. mrmvegger chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, orien
> t(2)

                                       MVMR-Egger model oriented wrt: hdlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4286398   .0614056     6.98   0.000      .308287    .5489926
    hdlcbeta |  -.1989637   .1541909    -1.29   0.197    -.5011723    .1032449
      tgbeta |   .2256794   .1243221     1.82   0.069    -.0179875    .4693463
       _cons |   .0002155   .0036218     0.06   0.953     -.006883    .0073141
------------------------------------------------------------------------------

. 
. assert _b[ldlcbeta] - .428 < 1e-3

. assert _b[hdlcbeta] - -.198 < 1e-3

. assert _b[tgbeta] - .225 < 1e-3

. assert _b[_cons] - -.0002 < 1e-3

. assert _se[ldlcbeta] - .061 < 1e-3

. assert _se[hdlcbeta] - .154 < 1e-3

. assert _se[tgbeta] - .124 < 1e-3

. assert _se[_cons] - .0036 < 1e-3

. 
. discard

. mrmvegger chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, orien
> t(3)

                                         MVMR-Egger model oriented wrt: tgbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4203073   .0660026     6.37   0.000     .2909447      .54967
    hdlcbeta |  -.1903089   .1321536    -1.44   0.150    -.4493252    .0687075
      tgbeta |   .2065651   .1365427     1.51   0.130    -.0610537     .474184
       _cons |   .0013499    .003951     0.34   0.733    -.0063939    .0090936
------------------------------------------------------------------------------

. 
. assert _b[ldlcbeta] - .420 < 1e-3

. assert _b[hdlcbeta] - -.190 < 1e-3

. assert _b[tgbeta] - .206 < 1e-3

. assert _b[_cons] - .0013 < 1e-3

. assert _se[ldlcbeta] - .066 < 1e-3

. assert _se[hdlcbeta] - .132 < 1e-3

. assert _se[tgbeta] - .136 < 1e-3

. assert _se[_cons] - .0039 < 1e-3

. 
. * check orient not greater than no. phenotypes
. rcof "noi mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, orient(2)" 
> == 198
The orient() option must be in the range of the number of phenotypes

. 
. * check orient not negative
. discard

. rcof "noi mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, orient(-1)"
>  == 198
The orient() option cannot be negative

. 
. * test replay
. discard

. mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. mrmvegger

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. 
. * eret list
. discard

. mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. eret list

scalars:
                  e(N) =  73

macros:
            e(cmdline) : "mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if se.."
                e(cmd) : "mrmvegger"
          e(orientvar) : "ldlcbeta"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 2
                  e(V) :  2 x 2

. 
. * ret list
. ret list

scalars:
              r(level) =  95

macros:
           r(mcmethod) : "noadjust"

matrices:
              r(table) :  9 x 2

. 
. * e(N)
. assert `e(N)' == 73

. 
. * e(orientvar)
. assert "`e(orientvar)'" == "ldlcbeta"

. 
. * e(cmd), e(cmdline)
. discard

. mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. di e(cmd)
mrmvegger

. assert "`e(cmd)'" == "mrmvegger"

. di e(cmdline)
mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

. assert "`e(cmdline)'" == "mrmvegger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1
> ==1"

. 
end of do-file
      name:  mrmvegger
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmvegger.log
  log type:  text
 closed on:  27 Jun 2020, 22:57:03
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrmvivw
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmvivw.log
  log type:  text
 opened on:  27 Jun 2020, 22:57:03

. * mrmvivw cscript
. * 22jun2020
. 
. cscript mrmvivw adofiles mrmvivw mvivw mvmr
------------------------------------------------------------------BEGIN mrmvivw

-> which mrmvivw, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmvivw.ado
*! version 0.1.0 22jun2020 Tom Palmer

-> which mvivw, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mvivw.ado
*! version 0.1.0 22jun2020 Tom Palmer

-> which mvmr, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mvmr.ado
*! version 0.1.0 22jun2020 Tom Palmer

. 
. * load in dataset
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. * ldlc - analysis 1
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. * check univariate estimate
. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. 
. discard

. mrmvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .482) < 1e-3

. assert abs(_se[ldlcbeta] - .038) < 1e-3

. 
. * r(table)
. mat list r(table)

r(table)[9,1]
          chdbeta:
         ldlcbeta
     b  .48150551
    se  .03822098
     z  12.597937
pvalue  2.167e-36
    ll  .40659377
    ul  .55641726
    df          .
  crit   1.959964
 eform          0

. 
. discard

. mvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .482) < 1e-3

. assert abs(_se[ldlcbeta] - .038) < 1e-3

. 
. discard

. mvmr chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .482) < 1e-3

. assert abs(_se[ldlcbeta] - .038) < 1e-3

. 
. * fit a multivariate estimate
. 
. ** without FE SEs
. discard

. mrmvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3091286    .5481113
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4506189    .0622211
      tgbeta |   .2260456   .1232828     1.83   0.067    -.0155842    .4676755
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .429) < 1e-3

. assert abs(_se[ldlcbeta] - .061) < 1e-3

. assert abs(_b[hdlcbeta] - -.194) < 1e-3

. assert abs(_se[hdlcbeta] - .131) < 1e-3

. assert abs(_b[tgbeta] - .226) < 1e-3

. assert abs(_se[tgbeta] - .123) < 1e-3

. 
. discard

. mvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3091286    .5481113
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4506189    .0622211
      tgbeta |   .2260456   .1232828     1.83   0.067    -.0155842    .4676755
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .429) < 1e-3

. assert abs(_se[ldlcbeta] - .061) < 1e-3

. assert abs(_b[hdlcbeta] - -.194) < 1e-3

. assert abs(_se[hdlcbeta] - .131) < 1e-3

. assert abs(_b[tgbeta] - .226) < 1e-3

. assert abs(_se[tgbeta] - .123) < 1e-3

. 
. discard

. mvmr chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3091286    .5481113
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4506189    .0622211
      tgbeta |   .2260456   .1232828     1.83   0.067    -.0155842    .4676755
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .429) < 1e-3

. assert abs(_se[ldlcbeta] - .061) < 1e-3

. assert abs(_b[hdlcbeta] - -.194) < 1e-3

. assert abs(_se[hdlcbeta] - .131) < 1e-3

. assert abs(_b[tgbeta] - .226) < 1e-3

. assert abs(_se[tgbeta] - .123) < 1e-3

. 
. ** with FE SEs
. discard

. mrmvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0409208    10.47   0.000     .3484166    .5088234
    hdlcbeta |  -.1941989   .0878132    -2.21   0.027    -.3663097   -.0220881
      tgbeta |   .2260456   .0827482     2.73   0.006     .0638621    .3882291
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .429) < 1e-3

. assert abs(_se[ldlcbeta] - .041) < 1e-3

. assert abs(_b[hdlcbeta] - -.194) < 1e-3

. assert abs(_se[hdlcbeta] - .088) < 1e-3

. assert abs(_b[tgbeta] - .226) < 1e-3

. assert abs(_se[tgbeta] - .083) < 1e-3

. 
. discard

. mvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0409208    10.47   0.000     .3484166    .5088234
    hdlcbeta |  -.1941989   .0878132    -2.21   0.027    -.3663097   -.0220881
      tgbeta |   .2260456   .0827482     2.73   0.006     .0638621    .3882291
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .429) < 1e-3

. assert abs(_se[ldlcbeta] - .041) < 1e-3

. assert abs(_b[hdlcbeta] - -.194) < 1e-3

. assert abs(_se[hdlcbeta] - .088) < 1e-3

. assert abs(_b[tgbeta] - .226) < 1e-3

. assert abs(_se[tgbeta] - .083) < 1e-3

. 
. discard

. mvmr chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0409208    10.47   0.000     .3484166    .5088234
    hdlcbeta |  -.1941989   .0878132    -2.21   0.027    -.3663097   -.0220881
      tgbeta |   .2260456   .0827482     2.73   0.006     .0638621    .3882291
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .429) < 1e-3

. assert abs(_se[ldlcbeta] - .041) < 1e-3

. assert abs(_b[hdlcbeta] - -.194) < 1e-3

. assert abs(_se[hdlcbeta] - .088) < 1e-3

. assert abs(_b[tgbeta] - .226) < 1e-3

. assert abs(_se[tgbeta] - .083) < 1e-3

. 
. ** 90% CI
. discard

. mrmvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, level(9
> 0)

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3283397    .5289003
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4093933    .0209956
      tgbeta |   .2260456   .1232828     1.83   0.067     .0232635    .4288278
------------------------------------------------------------------------------

. mat table = r(table)

. assert abs(_b[ldlcbeta] - invnorm(.95)*_se[ldlcbeta] - .328) < 1e-3

. assert abs(_b[ldlcbeta] + invnorm(.95)*_se[ldlcbeta] - .529) < 1e-3

. 
. discard

. mvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, level(90)

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3283397    .5289003
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4093933    .0209956
      tgbeta |   .2260456   .1232828     1.83   0.067     .0232635    .4288278
------------------------------------------------------------------------------

. mat table = r(table)

. assert abs(_b[ldlcbeta] - invnorm(.95)*_se[ldlcbeta] - .328) < 1e-3

. assert abs(_b[ldlcbeta] + invnorm(.95)*_se[ldlcbeta] - .529) < 1e-3

. 
. discard

. mvmr chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, level(90)

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3283397    .5289003
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4093933    .0209956
      tgbeta |   .2260456   .1232828     1.83   0.067     .0232635    .4288278
------------------------------------------------------------------------------

. mat table = r(table)

. assert abs(_b[ldlcbeta] - invnorm(.95)*_se[ldlcbeta] - .328) < 1e-3

. assert abs(_b[ldlcbeta] + invnorm(.95)*_se[ldlcbeta] - .529) < 1e-3

. 
. * eret list
. eret list

scalars:
                  e(N) =  73

macros:
            e(cmdline) : "mrmvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(c.."
                e(cmd) : "mrmvivw"
             e(setype) : "re"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 3
                  e(V) :  3 x 3

. 
. * ret list
. ret list

scalars:
              r(level) =  90

macros:
           r(mcmethod) : "noadjust"

matrices:
              r(table) :  9 x 3

. 
. * Display
. discard

. mrmvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. mrmvivw

                                                       Number of genotypes: 73
                                                 Standard errors: Fixed effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. 
. assert `e(N)' == 73

. assert "`e(setype)'" == "fe"

. 
. discard

. mrmvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. mrmvivw

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. assert "`e(setype)'" == "re"

. 
. * e(cmd), e(cmdline)
. discard

. mrmvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. di e(cmd)
mrmvivw

. assert "`e(cmd)'" == "mrmvivw"

. di e(cmdline)
mrmvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

. assert "`e(cmdline)'" == "mrmvivw chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==
> 1"

. 
end of do-file
      name:  mrmvivw
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmvivw.log
  log type:  text
 closed on:  27 Jun 2020, 22:57:13
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mr
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mr.log
  log type:  text
 opened on:  27 Jun 2020, 22:57:13

. * mr cscript
. * 20jan2020
. 
. cscript mr adofiles ///
> mrmvegger ///
> mrmvivw ///
> mr ///
> mrdeps ///
> mregger ///
> mreggerplot ///
> mreggersimex ///
> mreggersimexonce ///
> mrforest ///
> mrfunnel ///
> mrivests ///
> mrmedian ///
> mrmedianobs ///
> mrmedianobs_work ///
> mrmodal ///
> mrmodalplot ///
> mrratio
-----------------------------------------------------------------------BEGIN mr

-> which mrmvegger, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmvegger.ado
*! version 0.1.0 23jun2020 Tom Palmer

-> which mrmvivw, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmvivw.ado
*! version 0.1.0 22jun2020 Tom Palmer

-> which mr, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mr.ado
*! version 0.1.0 19jan2020 Tom Palmer

-> which mrdeps, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrdeps.ado
*! version 0.1.0 18dec2018 Tom Palmer

-> which mregger, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mregger.ado
*! version 0.1.0 04jun2016 Tom Palmer

-> which mreggerplot, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mreggerplot.ado
*! version 0.1.0 Tom Palmer 06jun2016

-> which mreggersimex, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mreggersimex.ado
*! 0.1.0 20jul2017 Tom Palmer

-> which mreggersimexonce, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mreggersimexonce.ado
*! 0.1.0 23jul2017 Tom Palmer

-> which mrforest, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrforest.ado
*! version 0.1.0 Tom Palmer 15jun2017

-> which mrfunnel, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrfunnel.ado
*! 0.1.0 Tom Palmer 29aug2017

-> which mrivests, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrivests.ado
*! 0.1.0 Tom Palmer 10jun2017

-> which mrmedian, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmedian.ado
*! version 0.1.0 03jun2016 Tom Palmer

-> which mrmedianobs, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmedianobs.ado
*! version 0.1.0 04jun2016 Tom Palmer

-> which mrmedianobs_work, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmedianobs_work.ado
*! version 0.1.0 04jun2016 Tom Palmer

-> which mrmodal, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmodal.ado
*! version 0.1.0 02jun2017 Tom Palmer

-> which mrmodalplot, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmodalplot.ado
*! 0.1.0 2aug2017 Tom Palmer

-> which mrratio, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrratio.ado
*! 1.0.0 Tom Palmer 30may2017, based on my old tsci.ado from 8jan2010

. 
. rcof "noi mr incorrectsubcommandname" ///
>         == 198
incorrectsubcommandname is not a valid subcommand.

. 
. mr deps
checking addplot consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
checking kdens consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
checking moremata consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
checking heterogi consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
checking metan consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
checking grc1leg consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.

. 
. ** Do et al. dataset
. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. mr egger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. 
. mr eggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1

. 
. mr eggersimex chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, gxse(ldlcse) seed(1
> 2345) noboot

                                                      Number of genotypes = 73
                                                    Bootstrap replications = 0
                                                  Simulation replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6256194          .        .       .            .           .
       _cons |  -.0089987          .        .       .            .           .
------------------------------------------------------------------------------

. 
. mr forest chdbeta chdse ldlcbeta ldlcse if sel1==1, ivid(rsid)

. 
. mr funnel chdbeta chdse ldlcbeta ldlcse if sel1==1

. 
. mr ivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest ivse)

. 
. mr median chdbeta chdse ldlcbeta ldlcse if sel1==1

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0715535     5.99   0.000     .2883292    .5688136
------------------------------------------------------------------------------

. 
. mr modal chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0652193     7.34   0.000     .3511427    .6067977
------------------------------------------------------------------------------

. 
. mr modalplot chdbeta chdse ldlcbeta ldlcse if sel1==1

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2332927     1.80   0.072     -.037374    .8771166
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1905195     2.21   0.027     .0484554    .7952781
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1312092     3.75   0.000     .2345699    .7489007
------------------------------------------------------------------------------

. 
. mr ratio 1 .5 1 .25, eform

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.519566     1.79   0.074     .9087791     8.13075
------------------------------------------------------------------------------

. 
. ** mv estimators
. 
. mr mvivw chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1

                                                       Number of genotypes: 73
                                                Standard errors: Random effect
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |     .42862   .0609661     7.03   0.000     .3091286    .5481113
    hdlcbeta |  -.1941989   .1308289    -1.48   0.138    -.4506189    .0622211
      tgbeta |   .2260456   .1232828     1.83   0.067    -.0155842    .4676755
------------------------------------------------------------------------------

. 
. mr mvegger chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1

                                       MVMR-Egger model oriented wrt: ldlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .5672993   .1002611     5.66   0.000      .370791    .7638075
    hdlcbeta |  -.1364113   .1332727    -1.02   0.306    -.3976209    .1247983
      tgbeta |   .2739803   .1246927     2.20   0.028     .0295871    .5183735
       _cons |  -.0093655   .0054187    -1.73   0.084     -.019986     .001255
------------------------------------------------------------------------------

. 
. mr mvegger chdbeta ldlcbeta hdlcbeta tgbeta [aw=1/(chdse^2)] if sel1==1, orie
> nt(2)

                                       MVMR-Egger model oriented wrt: hdlcbeta
                                                       Number of genotypes: 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4286398   .0614056     6.98   0.000      .308287    .5489926
    hdlcbeta |  -.1989637   .1541909    -1.29   0.197    -.5011723    .1032449
      tgbeta |   .2256794   .1243221     1.82   0.069    -.0179875    .4693463
       _cons |   .0002155   .0036218     0.06   0.953     -.006883    .0073141
------------------------------------------------------------------------------

. 
. ** mrmedianobs test dataset
. 
. use https://raw.github.com/remlapmot/mrrobust/master/mrmedianobs_testdata, cl
> ear

. mr medianobs y (x = z1-z20), weighted

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9987268   .0633445    15.77   0.000     .8745738     1.12288
------------------------------------------------------------------------------

. 
end of do-file
      name:  mr
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mr.log
  log type:  text
 closed on:  27 Jun 2020, 22:58:49
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrdeps
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrdeps.log
  log type:  text
 opened on:  27 Jun 2020, 22:58:49

. * mrdeps cscript
. * 20jan2020
. 
. cscript mrdeps adofiles mrdeps
-------------------------------------------------------------------BEGIN mrdeps

-> which mrdeps, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrdeps.ado
*! version 0.1.0 18dec2018 Tom Palmer

. 
. mrdeps
checking addplot consistency and verifying not already installed...
all files already exist and are up to date.
checking kdens consistency and verifying not already installed...
all files already exist and are up to date.
checking moremata consistency and verifying not already installed...
all files already exist and are up to date.
checking heterogi consistency and verifying not already installed...
all files already exist and are up to date.
checking metan consistency and verifying not already installed...
all files already exist and are up to date.
checking grc1leg consistency and verifying not already installed...
all files already exist and are up to date.

. 
end of do-file
      name:  mrdeps
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrdeps.log
  log type:  text
 closed on:  27 Jun 2020, 23:00:32
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mregger
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mregger.log
  log type:  text
 opened on:  27 Jun 2020, 23:00:32

. * mregger cscript
. * 04jun2016
. 
. cscript mregger adofiles mregger
------------------------------------------------------------------BEGIN mregger

-> which mregger, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mregger.ado
*! version 0.1.0 04jun2016 Tom Palmer

. 
. *** load in dataset
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. *** ldlc - analysis 1
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. *** ivw
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .482) < 1e-3

. assert abs(_se[ldlcbeta] - 0.060) < 1e-3

. 
. * r(table)
. mat list r(table)

r(table)[9,1]
          chdbeta:
         ldlcbeta
     b  .48150551
    se  .05979938
     z  8.0520154
pvalue  8.144e-16
    ll  .36430088
    ul  .59871014
    df          .
  crit   1.959964
 eform          0

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mat list r(table)

r(table)[9,2]
         sign(ldlc~a:  sign(ldlc~a:
               slope         _cons
     b     .61731315    -.00877065
    se     .10345735     .00548118
     z     5.9668371      -1.60014
pvalue     2.419e-09     .10956752
    ll     .41454047    -.01951356
    ul     .82008582     .00197226
    df             .             .
  crit      1.959964      1.959964
 eform             0             0

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, heterogi
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.5               1.4    1.8     
      I^2 |          58                 46    68      
------------------------------------------------------
Q-test = 170.11187 d.f. = 71 p-value = 0.0000

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mat list r(table)

r(table)[9,2]
         sign(ldlc~a:  sign(ldlc~a:
               slope         _cons
     b     .61731315    -.00877065
    se     .10345735     .00548118
     z     5.9668371      -1.60014
pvalue     2.419e-09     .10956752
    ll     .41454047    -.01951356
    ul     .82008582     .00197226
    df             .             .
  crit      1.959964      1.959964
 eform             0             0

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, gxse(ldlcse) heterogi
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.5               1.4    1.8     
      I^2 |          58                 46    68      
------------------------------------------------------
Q-test = 170.11187 d.f. = 71 p-value = 0.0000
                                            Q_GX statistic (weighted): 3454.26
                                          I^2_GX statistic (weighted):  97.92%

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mat list r(table)

r(table)[9,2]
         sign(ldlc~a:  sign(ldlc~a:
               slope         _cons
     b     .61731315    -.00877065
    se     .10345735     .00548118
     z     5.9668371      -1.60014
pvalue     2.419e-09     .10956752
    ll     .41454047    -.01951356
    ul     .82008582     .00197226
    df             .             .
  crit      1.959964      1.959964
 eform             0             0

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, gxse(ldlcse)
                                            Q_GX statistic (weighted): 3454.26
                                          I^2_GX statistic (weighted):  97.92%

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mat list r(table)

r(table)[9,2]
         sign(ldlc~a:  sign(ldlc~a:
               slope         _cons
     b     .61731315    -.00877065
    se     .10345735     .00548118
     z     5.9668371      -1.60014
pvalue     2.419e-09     .10956752
    ll     .41454047    -.01951356
    ul     .82008582     .00197226
    df             .             .
  crit      1.959964      1.959964
 eform             0             0

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, radial

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |    .642582   .1157871     5.55   0.000     .4156434    .8695205
       _cons |  -.5737301   .3545658    -1.62   0.106    -1.268666    .1212062
------------------------------------------------------------------------------
                                               Residual standard error:  1.547

. mat list r(table)

r(table)[9,2]
          radialGD:   radialGD:
          radialGP       _cons
     b   .64258196  -.57373006
    se   .11578709   .35456584
     z   5.5496858    -1.61812
pvalue   2.862e-08   .10563675
    ll   .41564344  -1.2686663
    ul   .86952048   .12120621
    df           .           .
  crit    1.959964    1.959964
 eform           0           0

. 
. version 12: mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. assert abs(_b[ldlcbeta] - .482) < 1e-3

. assert abs(_se[ldlcbeta] - 0.060) < 1e-3

. 
. * check directional adjustment does not affect estimates
. gen double ycheck = chdbeta*sign(ldlcbeta)

. gen double xcheck = abs(ldlcbeta)

. regress ycheck xcheck [aw=1/(chdse^2)] if sel1==1, nocons
(sum of wgt is 243,877.358297371)

      Source |       SS           df       MS      Number of obs   =        73
-------------+----------------------------------   F(1, 72)        =     64.83
       Model |  .047506198         1  .047506198   Prob > F        =    0.0000
    Residual |  .052756209        72  .000732725   R-squared       =    0.4738
-------------+----------------------------------   Adj R-squared   =    0.4665
       Total |  .100262406        73  .001373458   Root MSE        =    .02707

------------------------------------------------------------------------------
      ycheck |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      xcheck |   .4815055   .0597994     8.05   0.000     .3622976    .6007134
------------------------------------------------------------------------------

. assert abs(_b[xcheck] - .482) < 1e-3

. assert abs(_se[xcheck] - 0.060) < 1e-3

. 
. *** mregger
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. assert abs(_b[slope] - .617) < 1e-3

. assert abs(_b[_cons] - -.009) < 1e-3

. eret list

scalars:
               e(df_r) =  .
                e(phi) =  1.547885800541125
                  e(k) =  73

macros:
            e(cmdline) : "mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1.."
                e(cmd) : "mregger"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 2
                  e(V) :  2 x 2

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. eret list

scalars:
               e(df_r) =  .
                e(phi) =  1.547885800541125
                  e(k) =  73

macros:
            e(cmdline) : "mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1.."
                e(cmd) : "mregger"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 2
                  e(V) :  2 x 2

. 
. version 12: mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. assert abs(_b[slope] - .617) < 1e-3

. assert abs(_b[_cons] - -.009) < 1e-3

. 
. *** test replay
. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. 
. ** ci level
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, level(90)

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000      .447141    .7874853
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0177864    .0002451
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. 
. *** fe standard errors (default is multiplicative)
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .0668378     9.24   0.000     .4863134    .7483129
       _cons |  -.0087706   .0035411    -2.48   0.013     -.015711   -.0018303
------------------------------------------------------------------------------
                                                    Residual standard error: 1

. 
. version 12: mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .0668378     9.24   0.000     .4863134    .7483129
       _cons |  -.0087706   .0035411    -2.48   0.013     -.015711   -.0018303
------------------------------------------------------------------------------
                                                    Residual standard error: 1

. 
. *** re
. /*
> mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re noestimate
> mat b = e(b)
> mat b[1,1] = .575
> mat b[1,2] = -.0065
> mat b[1,6] = .0046
> mat b[1,7] = .0026
> mat b[1,8] = -.00067
> mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re from(b)
> eret list
> */
. 
. *** ivw fe SEs
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. 
. version 12: mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. 
. *** ivw re
. /*
> mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw re noestimate
> mat b = e(b)
> mat b[1,1] = .417
> mat b[1,4] = .218
> mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw re from(b)
> */
. 
. rcof "version 12: noi mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, r
> e" ///
>         == 9
option re requires Stata version 13 or higher

. 
. rcof "noi mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw recons" /
> //
>         == 198
option  recons must be specified with option re

. 
. rcof "noi mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw reslope" 
> ///
>         == 198
option reslope  must be specified with option re

. 
. rcof "noi mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw recons re
> slope" ///
>         == 198
option reslope recons must be specified with option re

. 
. rcof "noi mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw re recons
> " == 198
For IVW estimator option recons not allowed for re estimation (as there is no c
> onstant)

. 
. * mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re recons
. 
. *** reslope
. * mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re reslope
. 
. *** both
. /*
> mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re recons reslope noest
> imate
> mat b = e(b)
> mat b[1,1] = .575
> mat b[1,2] = -.0065
> mat b[1,6] = .0046
> mat b[1,7] = .0026
> mat b[1,8] = -.00067
> mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re recons reslope from(
> b)
> */
. 
. *** gsemopts
. * mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, re recons vce(robust)
. 
. * level
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, level(90)

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000      .447141    .7874853
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0177864    .0002451
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. mregger, level(90)
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000      .447141    .7874853
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0177864    .0002451
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, tdist level(90) 

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4448912    .7897351
       _cons |  -.0087706   .0054812    -1.60   0.114    -.0179056    .0003643
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger, level(95)
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4110251    .8236012
       _cons |  -.0087706   .0054812    -1.60   0.114    -.0196998    .0021585
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, tdist ivw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3622976    .6007134
------------------------------------------------------------------------------

. mregger, level(90)
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3818622    .5811488
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, tdist ivw level(90)

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3818622    .5811488
------------------------------------------------------------------------------

. mregger, level(95)
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3622976    .6007134
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, tdist ivw fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4053134    .5576976
------------------------------------------------------------------------------

. mregger, level(90)
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4178181    .5451929
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, tdist ivw penw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4650819   .0399012    11.66   0.000     .3855403    .5446234
------------------------------------------------------------------------------

. 
. /*
> *** hdlc exposure
> gen byte sel2 = (hdlcp2 < 1e-8)
> mregger chdbeta hdlcbeta [aw=1/(chdse^2)] if sel2==1, re recons reslope
> 
> *** trigs exposure
> gen byte sel3 = (tgp2 < 1e-8)
> mregger chdbeta tgbeta [aw=1/(chdse^2)] if sel3==1, re recons reslope
> */
. 
. *** ivw fe SEs
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. 
. *** heterogi option - changed from noheterogi
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, heterogi
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.5               1.4    1.8     
      I^2 |          58                 46    68      
------------------------------------------------------
Q-test = 170.11187 d.f. = 71 p-value = 0.0000

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, het
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.5               1.4    1.8     
      I^2 |          58                 46    68      
------------------------------------------------------
Q-test = 170.11187 d.f. = 71 p-value = 0.0000

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw heterogi
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.6               1.4    1.8     
      I^2 |          59                 47    68      
------------------------------------------------------
Q-test = 176.24718 d.f. = 72 p-value = 0.0000

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw het
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.6               1.4    1.8     
      I^2 |          59                 47    68      
------------------------------------------------------
Q-test = 176.24718 d.f. = 72 p-value = 0.0000

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, heterogi penweighted
Residual variance = .97685468; rerunning with residual variance set to 1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .5274159   .0681008     7.74   0.000     .3939408    .6608911
       _cons |  -.0050223   .0036849    -1.36   0.173    -.0122446    .0022001
------------------------------------------------------------------------------
                                               Residual standard error:  0.988

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw heterogi penweighte
> d

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4650819   .0399012    11.66   0.000      .386877    .5432867
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1==1, ivw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. eret list

scalars:
               e(df_r) =  .
                  e(k) =  73

macros:
            e(cmdline) : "mregger chdbeta ldlcbeta [aw=1/(chdse^2)] if sel1.."
                e(cmd) : "mregger"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 1
                  e(V) :  1 x 1

. mregger
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. 
. *** check the i^2 and q stats for this example
. cap noi which tsci
command tsci not found as either built-in or ado-file

. if _rc != 0 {
.         net install tsci, from(https://raw.github.com/remlapmot/tsci/master)
checking tsci consistency and verifying not already installed...
installing into c:\ado\plus\...
installation complete.
. }

. 
. gen double ivests = chdbeta/ldlcbeta if sel1==1
(112 missing values generated)

. gen double se = .
(185 missing values generated)

. local n = _N

. qui forvalues i = 1/`n' {

. replace se = . if sel1==0
(112 real changes made, 112 to missing)

. gen double sefdm = chdse/abs(ldlcbeta) if sel1==1 
(112 missing values generated)

. list se sefdm if sel1==1

     +-----------------------+
     |        se       sefdm |
     |-----------------------|
  1. | .41620703   .41421335 |
  3. | .25490917   .25388702 |
  5. | .30920822   .30800915 |
  6. | .50182747   .49970253 |
  8. | .10896332   .10777225 |
     |-----------------------|
  9. | .77946727   .75891504 |
 10. | .65123353   .65110063 |
 14. | .47081638   .46589113 |
 15. | .60441547   .57803354 |
 18. | .32720374   .32720008 |
     |-----------------------|
 19. | .12866373    .1282934 |
 20. | .13857245   .13769139 |
 23. | .20613456   .20249612 |
 24. | .49622189   .49227703 |
 25. | .63882794   .62885202 |
     |-----------------------|
 26. |  .5282771   .52096301 |
 28. | .57251621   .57065087 |
 31. | .63534627   .63275717 |
 33. | .81148225   .77342728 |
 36. | .53961247   .53181641 |
     |-----------------------|
 42. |  .6747876   .60878681 |
 56. | .19569181   .19431952 |
 57. | .49836398   .49710325 |
 58. | .31941661   .31713217 |
 59. | .47912203   .47894779 |
     |-----------------------|
 60. | .48081609   .47768152 |
 61. | .66578104   .63301225 |
 65. | .54232304   .53255152 |
 69. | .47461549   .46356957 |
 70. | .41631225   .39516211 |
     |-----------------------|
 74. |  .4954845   .49475005 |
 75. | .71267175    .7049174 |
 76. | .54478026   .54305114 |
 77. | .41216395   .40576627 |
 84. | .37355841   .37241555 |
     |-----------------------|
 90. | .52182104   .51904619 |
 91. | .43538972   .43501965 |
 93. | .50069571   .49961178 |
 95. | .58119533   .54903571 |
 96. | .26260854   .25373282 |
     |-----------------------|
 98. | .42055763   .41897469 |
 99. | .59390941   .58010431 |
102. | .57055061   .56641616 |
104. | .44522459   .43501946 |
105. |  .2919475   .27459403 |
     |-----------------------|
110. | .52697302   .52588585 |
113. | .51847418   .48870899 |
118. | .65118315   .65034413 |
119. | .28529493   .28528308 |
122. |  .3943812   .35985138 |
     |-----------------------|
125. | .38022371   .36931131 |
130. | .89866272   .70429776 |
131. | .71121548   .62593135 |
133. | .44088436   .39438585 |
136. | .81812597   .81812597 |
     |-----------------------|
138. | .65987167   .65547617 |
149. | .70195316   .70017926 |
152. | .48524227   .47467397 |
153. | .28687074   .28357557 |
155. | .60713808   .60359458 |
     |-----------------------|
159. | .51730752   .51328701 |
166. | .15971813   .15888854 |
167. |  .2704075   .26080546 |
168. |  .2527411   .24648094 |
171. | .24225166   .24202126 |
     |-----------------------|
172. | .16869525   .16852346 |
173. | .54992353   .54990481 |
176. | .56630617   .56462456 |
177. | .93462319   .93415893 |
179. | .40555349   .40291862 |
     |-----------------------|
180. | .33204247   .32967475 |
181. | .63341594   .62983783 |
184. | .66640616   .66611186 |
     +-----------------------+

. metan ivests se if sel1==1, nograph

           Study     |     ES    [95% Conf. Interval]     % Weight
---------------------+---------------------------------------------------
1                    |  0.364      -0.452     1.179          0.87
3                    |  0.395      -0.105     0.894          2.31
5                    | -0.347      -0.953     0.259          1.57
6                    |  0.353      -0.631     1.337          0.60
8                    |  0.587       0.374     0.801         12.66
9                    |  1.120      -0.408     2.648          0.25
10                   |  0.082      -1.195     1.358          0.35
14                   |  0.571      -0.351     1.494          0.68
15                   | -1.148      -2.333     0.036          0.41
18                   | -0.016      -0.658     0.625          1.40
19                   |  0.292       0.039     0.544          9.08
20                   |  0.457       0.186     0.729          7.83
23                   |  0.753       0.349     1.157          3.54
24                   |  0.591      -0.382     1.563          0.61
25                   |  0.708      -0.544     1.960          0.37
26                   |  0.653      -0.382     1.688          0.54
28                   | -0.316      -1.438     0.806          0.46
31                   | -0.332      -1.577     0.913          0.37
33                   | -1.417      -3.007     0.174          0.23
36                   |  0.667      -0.391     1.724          0.52
42                   |  1.833       0.511     3.156          0.33
56                   |  0.452       0.069     0.836          3.92
57                   | -0.268      -1.245     0.709          0.61
58                   |  0.457      -0.170     1.083          1.47
59                   | -0.115      -1.054     0.824          0.65
60                   |  0.419      -0.523     1.362          0.65
61                   |  1.200      -0.105     2.505          0.34
65                   |  0.731      -0.332     1.794          0.51
69                   |  0.879      -0.051     1.809          0.67
70                   |  1.271       0.455     2.087          0.87
74                   | -0.218      -1.189     0.753          0.61
75                   |  0.846      -0.551     2.243          0.30
76                   |  0.429      -0.639     1.496          0.51
77                   |  0.694      -0.113     1.502          0.88
84                   |  0.313      -0.419     1.046          1.08
90                   |  0.375      -0.648     1.398          0.55
91                   | -0.162      -1.015     0.692          0.79
93                   | -0.255      -1.236     0.727          0.60
95                   |  1.323       0.183     2.462          0.44
96                   |  1.018       0.503     1.533          2.18
98                   | -0.324      -1.148     0.501          0.85
99                   |  0.778      -0.386     1.942          0.43
102                  |  0.467      -0.652     1.585          0.46
104                  |  0.818      -0.054     1.691          0.76
105                  |  1.463       0.890     2.035          1.76
110                  | -0.253      -1.286     0.780          0.54
113                  |  1.375       0.359     2.391          0.56
118                  |  0.277      -0.999     1.553          0.35
119                  |  0.036      -0.523     0.595          1.85
122                  |  1.711       0.938     2.483          0.97
125                  |  0.898       0.153     1.644          1.04
130                  | -3.348      -5.109    -1.586          0.19
131                  | -1.964      -3.358    -0.570          0.30
133                  |  1.842       0.978     2.706          0.77
136                  |  0.000      -1.603     1.603          0.22
138                  | -0.600      -1.893     0.693          0.35
149                  |  0.357      -1.019     1.733          0.30
152                  |  0.759      -0.192     1.710          0.64
153                  |  0.615       0.053     1.178          1.83
155                  |  0.417      -0.773     1.607          0.41
159                  |  0.500      -0.514     1.514          0.56
166                  |  0.591       0.278     0.904          5.89
167                  |  1.037       0.507     1.567          2.06
168                  |  0.917       0.421     1.412          2.35
171                  |  0.226      -0.249     0.701          2.56
172                  |  0.286      -0.045     0.616          5.28
173                  |  0.034      -1.043     1.112          0.50
176                  |  0.288      -0.822     1.398          0.47
177                  | -0.177      -2.008     1.655          0.17
179                  |  0.444      -0.350     1.239          0.91
180                  |  0.452      -0.198     1.103          1.36
181                  | -0.435      -1.676     0.807          0.37
184                  | -0.126      -1.432     1.180          0.34
---------------------+---------------------------------------------------
I-V pooled ES        |  0.475       0.399     0.551        100.00
---------------------+---------------------------------------------------

  Heterogeneity chi-squared = 150.95 (d.f. = 72) p = 0.000
  I-squared (variation in ES attributable to heterogeneity) =  52.3%

  Test of ES=0 : z=  12.26 p = 0.000

. metan ivests sefdm if sel1==1, nograph

           Study     |     ES    [95% Conf. Interval]     % Weight
---------------------+---------------------------------------------------
1                    |  0.364      -0.448     1.175          0.85
3                    |  0.395      -0.103     0.892          2.27
5                    | -0.347      -0.951     0.257          1.54
6                    |  0.353      -0.626     1.332          0.59
8                    |  0.587       0.376     0.799         12.58
9                    |  1.120      -0.367     2.607          0.25
10                   |  0.082      -1.194     1.358          0.34
14                   |  0.571      -0.342     1.485          0.67
15                   | -1.148      -2.281    -0.015          0.44
18                   | -0.016      -0.658     0.625          1.36
19                   |  0.292       0.040     0.543          8.88
20                   |  0.457       0.187     0.727          7.71
23                   |  0.753       0.356     1.150          3.56
24                   |  0.591      -0.374     1.556          0.60
25                   |  0.708      -0.524     1.941          0.37
26                   |  0.653      -0.368     1.674          0.54
28                   | -0.316      -1.434     0.803          0.45
31                   | -0.332      -1.572     0.908          0.36
33                   | -1.417      -2.933     0.099          0.24
36                   |  0.667      -0.376     1.709          0.52
42                   |  1.833       0.640     3.027          0.39
56                   |  0.452       0.071     0.833          3.87
57                   | -0.268      -1.242     0.706          0.59
58                   |  0.457      -0.165     1.078          1.45
59                   | -0.115      -1.054     0.824          0.64
60                   |  0.419      -0.517     1.356          0.64
61                   |  1.200      -0.041     2.441          0.36
65                   |  0.731      -0.313     1.775          0.52
69                   |  0.879      -0.030     1.787          0.68
70                   |  1.271       0.496     2.045          0.94
74                   | -0.218      -1.187     0.752          0.60
75                   |  0.846      -0.535     2.228          0.29
76                   |  0.429      -0.636     1.493          0.50
77                   |  0.694      -0.101     1.490          0.89
84                   |  0.313      -0.416     1.043          1.05
90                   |  0.375      -0.642     1.392          0.54
91                   | -0.162      -1.014     0.691          0.77
93                   | -0.255      -1.234     0.724          0.59
95                   |  1.323       0.246     2.399          0.48
96                   |  1.018       0.521     1.515          2.27
98                   | -0.324      -1.145     0.498          0.83
99                   |  0.778      -0.359     1.915          0.43
102                  |  0.467      -0.643     1.577          0.46
104                  |  0.818      -0.034     1.671          0.77
105                  |  1.463       0.924     2.001          1.94
110                  | -0.253      -1.284     0.777          0.53
113                  |  1.375       0.417     2.333          0.61
118                  |  0.277      -0.998     1.552          0.35
119                  |  0.036      -0.523     0.595          1.79
122                  |  1.711       1.005     2.416          1.13
125                  |  0.898       0.174     1.622          1.07
130                  | -3.348      -4.728    -1.967          0.29
131                  | -1.964      -3.191    -0.737          0.37
133                  |  1.842       1.069     2.615          0.94
136                  |  0.000      -1.603     1.603          0.22
138                  | -0.600      -1.885     0.685          0.34
149                  |  0.357      -1.015     1.729          0.30
152                  |  0.759      -0.172     1.689          0.65
153                  |  0.615       0.060     1.171          1.82
155                  |  0.417      -0.766     1.600          0.40
159                  |  0.500      -0.506     1.506          0.55
166                  |  0.591       0.279     0.902          5.79
167                  |  1.037       0.526     1.548          2.15
168                  |  0.917       0.434     1.400          2.40
171                  |  0.226      -0.248     0.701          2.49
172                  |  0.286      -0.045     0.616          5.14
173                  |  0.034      -1.043     1.112          0.48
176                  |  0.288      -0.819     1.395          0.46
177                  | -0.177      -2.008     1.654          0.17
179                  |  0.444      -0.345     1.234          0.90
180                  |  0.452      -0.194     1.099          1.34
181                  | -0.435      -1.669     0.800          0.37
184                  | -0.126      -1.432     1.180          0.33
---------------------+---------------------------------------------------
I-V pooled ES        |  0.482       0.407     0.556        100.00
---------------------+---------------------------------------------------

  Heterogeneity chi-squared = 176.25 (d.f. = 72) p = 0.000
  I-squared (variation in ES attributable to heterogeneity) =  59.1%

  Test of ES=0 : z=  12.60 p = 0.000

. 
. metan ivests se if sel1==1, random nograph

           Study     |     ES    [95% Conf. Interval]     % Weight
---------------------+---------------------------------------------------
1                    |  0.364      -0.452     1.179          1.43
3                    |  0.395      -0.105     0.894          2.25
5                    | -0.347      -0.953     0.259          1.94
6                    |  0.353      -0.631     1.337          1.13
8                    |  0.587       0.374     0.801          3.13
9                    |  1.120      -0.408     2.648          0.58
10                   |  0.082      -1.195     1.358          0.78
14                   |  0.571      -0.351     1.494          1.23
15                   | -1.148      -2.333     0.036          0.87
18                   | -0.016      -0.658     0.625          1.84
19                   |  0.292       0.039     0.544          3.03
20                   |  0.457       0.186     0.729          2.97
23                   |  0.753       0.349     1.157          2.56
24                   |  0.591      -0.382     1.563          1.15
25                   |  0.708      -0.544     1.960          0.80
26                   |  0.653      -0.382     1.688          1.06
28                   | -0.316      -1.438     0.806          0.94
31                   | -0.332      -1.577     0.913          0.81
33                   | -1.417      -3.007     0.174          0.55
36                   |  0.667      -0.391     1.724          1.03
42                   |  1.833       0.511     3.156          0.74
56                   |  0.452       0.069     0.836          2.62
57                   | -0.268      -1.245     0.709          1.15
58                   |  0.457      -0.170     1.083          1.89
59                   | -0.115      -1.054     0.824          1.21
60                   |  0.419      -0.523     1.362          1.20
61                   |  1.200      -0.105     2.505          0.75
65                   |  0.731      -0.332     1.794          1.02
69                   |  0.879      -0.051     1.809          1.22
70                   |  1.271       0.455     2.087          1.43
74                   | -0.218      -1.189     0.753          1.15
75                   |  0.846      -0.551     2.243          0.68
76                   |  0.429      -0.639     1.496          1.01
77                   |  0.694      -0.113     1.502          1.45
84                   |  0.313      -0.419     1.046          1.62
90                   |  0.375      -0.648     1.398          1.08
91                   | -0.162      -1.015     0.692          1.36
93                   | -0.255      -1.236     0.727          1.14
95                   |  1.323       0.183     2.462          0.92
96                   |  1.018       0.503     1.533          2.21
98                   | -0.324      -1.148     0.501          1.42
99                   |  0.778      -0.386     1.942          0.89
102                  |  0.467      -0.652     1.585          0.95
104                  |  0.818      -0.054     1.691          1.32
105                  |  1.463       0.890     2.035          2.04
110                  | -0.253      -1.286     0.780          1.06
113                  |  1.375       0.359     2.391          1.09
118                  |  0.277      -0.999     1.553          0.78
119                  |  0.036      -0.523     0.595          2.07
122                  |  1.711       0.938     2.483          1.52
125                  |  0.898       0.153     1.644          1.59
130                  | -3.348      -5.109    -1.586          0.46
131                  | -1.964      -3.358    -0.570          0.68
133                  |  1.842       0.978     2.706          1.34
136                  |  0.000      -1.603     1.603          0.54
138                  | -0.600      -1.893     0.693          0.76
149                  |  0.357      -1.019     1.733          0.69
152                  |  0.759      -0.192     1.710          1.19
153                  |  0.615       0.053     1.178          2.07
155                  |  0.417      -0.773     1.607          0.87
159                  |  0.500      -0.514     1.514          1.09
166                  |  0.591       0.278     0.904          2.85
167                  |  1.037       0.507     1.567          2.16
168                  |  0.917       0.421     1.412          2.27
171                  |  0.226      -0.249     0.701          2.33
172                  |  0.286      -0.045     0.616          2.79
173                  |  0.034      -1.043     1.112          1.00
176                  |  0.288      -0.822     1.398          0.96
177                  | -0.177      -2.008     1.655          0.43
179                  |  0.444      -0.350     1.239          1.48
180                  |  0.452      -0.198     1.103          1.82
181                  | -0.435      -1.676     0.807          0.81
184                  | -0.126      -1.432     1.180          0.75
---------------------+---------------------------------------------------
D+L pooled ES        |  0.438       0.310     0.566        100.00
---------------------+---------------------------------------------------

  Heterogeneity chi-squared = 150.95 (d.f. = 72) p = 0.000
  I-squared (variation in ES attributable to heterogeneity) =  52.3%
  Estimate of between-study variance Tau-squared =  0.1243

  Test of ES=0 : z=   6.71 p = 0.000

. metan ivests se if sel1==1, randomi nograph

           Study     |     ES    [95% Conf. Interval]     % Weight
---------------------+---------------------------------------------------
1                    |  0.364      -0.452     1.179          1.43
3                    |  0.395      -0.105     0.894          2.25
5                    | -0.347      -0.953     0.259          1.94
6                    |  0.353      -0.631     1.337          1.13
8                    |  0.587       0.374     0.801          3.13
9                    |  1.120      -0.408     2.648          0.58
10                   |  0.082      -1.195     1.358          0.78
14                   |  0.571      -0.351     1.494          1.23
15                   | -1.148      -2.333     0.036          0.87
18                   | -0.016      -0.658     0.625          1.84
19                   |  0.292       0.039     0.544          3.03
20                   |  0.457       0.186     0.729          2.97
23                   |  0.753       0.349     1.157          2.56
24                   |  0.591      -0.382     1.563          1.15
25                   |  0.708      -0.544     1.960          0.80
26                   |  0.653      -0.382     1.688          1.06
28                   | -0.316      -1.438     0.806          0.94
31                   | -0.332      -1.577     0.913          0.81
33                   | -1.417      -3.007     0.174          0.55
36                   |  0.667      -0.391     1.724          1.03
42                   |  1.833       0.511     3.156          0.74
56                   |  0.452       0.069     0.836          2.62
57                   | -0.268      -1.245     0.709          1.15
58                   |  0.457      -0.170     1.083          1.89
59                   | -0.115      -1.054     0.824          1.21
60                   |  0.419      -0.523     1.362          1.20
61                   |  1.200      -0.105     2.505          0.75
65                   |  0.731      -0.332     1.794          1.02
69                   |  0.879      -0.051     1.809          1.22
70                   |  1.271       0.455     2.087          1.43
74                   | -0.218      -1.189     0.753          1.15
75                   |  0.846      -0.551     2.243          0.68
76                   |  0.429      -0.639     1.496          1.01
77                   |  0.694      -0.113     1.502          1.45
84                   |  0.313      -0.419     1.046          1.62
90                   |  0.375      -0.648     1.398          1.08
91                   | -0.162      -1.015     0.692          1.36
93                   | -0.255      -1.236     0.727          1.14
95                   |  1.323       0.183     2.462          0.92
96                   |  1.018       0.503     1.533          2.21
98                   | -0.324      -1.148     0.501          1.42
99                   |  0.778      -0.386     1.942          0.89
102                  |  0.467      -0.652     1.585          0.95
104                  |  0.818      -0.054     1.691          1.32
105                  |  1.463       0.890     2.035          2.04
110                  | -0.253      -1.286     0.780          1.06
113                  |  1.375       0.359     2.391          1.09
118                  |  0.277      -0.999     1.553          0.78
119                  |  0.036      -0.523     0.595          2.07
122                  |  1.711       0.938     2.483          1.52
125                  |  0.898       0.153     1.644          1.59
130                  | -3.348      -5.109    -1.586          0.46
131                  | -1.964      -3.358    -0.570          0.68
133                  |  1.842       0.978     2.706          1.34
136                  |  0.000      -1.603     1.603          0.54
138                  | -0.600      -1.893     0.693          0.76
149                  |  0.357      -1.019     1.733          0.69
152                  |  0.759      -0.192     1.710          1.19
153                  |  0.615       0.053     1.178          2.07
155                  |  0.417      -0.773     1.607          0.87
159                  |  0.500      -0.514     1.514          1.09
166                  |  0.591       0.278     0.904          2.85
167                  |  1.037       0.507     1.567          2.16
168                  |  0.917       0.421     1.412          2.27
171                  |  0.226      -0.249     0.701          2.33
172                  |  0.286      -0.045     0.616          2.79
173                  |  0.034      -1.043     1.112          1.00
176                  |  0.288      -0.822     1.398          0.96
177                  | -0.177      -2.008     1.655          0.43
179                  |  0.444      -0.350     1.239          1.48
180                  |  0.452      -0.198     1.103          1.82
181                  | -0.435      -1.676     0.807          0.81
184                  | -0.126      -1.432     1.180          0.75
---------------------+---------------------------------------------------
D+L pooled ES        |  0.438       0.310     0.566        100.00
---------------------+---------------------------------------------------

  Heterogeneity chi-squared = 150.95 (d.f. = 72) p = 0.000
  I-squared (variation in ES attributable to heterogeneity) =  52.3%
  Estimate of between-study variance Tau-squared =  0.1243

  Test of ES=0 : z=   6.71 p = 0.000

. 
. ** norescale
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ivw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ivw norescale

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. 
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, norescale

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. 
. gen double chdbeta2 = chdbeta/100

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, ivw
Residual variance = .00024479; rerunning with residual variance set to 1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta2     |
    ldlcbeta |   .0048151    .038221     0.13   0.900    -.0700967    .0797268
------------------------------------------------------------------------------

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, ivw norescale
Residual variance = .00024479; recommend refitting without norescale option

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta2     |
    ldlcbeta |   .0048151    .000598     8.05   0.000      .003643    .0059871
------------------------------------------------------------------------------

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1
Residual variance = .0002396; rerunning with residual variance set to 1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta2     |
       slope |   .0061731   .0668378     0.09   0.926    -.1248266    .1371729
       _cons |  -.0000877   .0035411    -0.02   0.980    -.0070281    .0068527
------------------------------------------------------------------------------
                                               Residual standard error:  0.015

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, norescale
Residual variance = .0002396; recommend refitting without norescale option

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta2     |
       slope |   .0061731   .0010346     5.97   0.000     .0041454    .0082009
       _cons |  -.0000877   .0000548    -1.60   0.110    -.0001951    .0000197
------------------------------------------------------------------------------
                                               Residual standard error:  0.015

. 
. ** penweighted
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ivw penweighted

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4650819   .0399012    11.66   0.000      .386877    .5432867
------------------------------------------------------------------------------

. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, penweighted
Residual variance = .97685468; rerunning with residual variance set to 1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .5274159   .0681008     7.74   0.000     .3939408    .6608911
       _cons |  -.0050223   .0036849    -1.36   0.173    -.0122446    .0022001
------------------------------------------------------------------------------
                                               Residual standard error:  0.988

. 
. ** penweighted norescale
. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, ivw penweighted
Residual variance = .00024479; rerunning with residual variance set to 1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta2     |
    ldlcbeta |   .0048151    .038221     0.13   0.900    -.0700967    .0797268
------------------------------------------------------------------------------

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, ivw penweighted norescal
> e
Residual variance = .00024479; recommend refitting without norescale option

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta2     |
    ldlcbeta |   .0048151    .000598     8.05   0.000      .003643    .0059871
------------------------------------------------------------------------------

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, penweighted
Residual variance = .0002396; rerunning with residual variance set to 1

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta2     |
       slope |   .0061731   .0668378     0.09   0.926    -.1248266    .1371729
       _cons |  -.0000877   .0035411    -0.02   0.980    -.0070281    .0068527
------------------------------------------------------------------------------
                                               Residual standard error:  0.015

. mregger chdbeta2 ldlcbeta [aw=1/chdse^2] if sel1==1, penweighted norescale
Residual variance = .0002396; recommend refitting without norescale option

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta2     |
       slope |   .0061731   .0010346     5.97   0.000     .0041454    .0082009
       _cons |  -.0000877   .0000548    -1.60   0.110    -.0001951    .0000197
------------------------------------------------------------------------------
                                               Residual standard error:  0.015

. 
. ** gxse
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, gxse(ldlcse)
                                            Q_GX statistic (weighted): 3454.26
                                          I^2_GX statistic (weighted):  97.92%

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
sign(ldlcb~a)|
chdbeta      |
       slope |   .6173131   .1034573     5.97   0.000     .4145405    .8200858
       _cons |  -.0087706   .0054812    -1.60   0.110    -.0195136    .0019723
------------------------------------------------------------------------------
                                               Residual standard error:  1.548

. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, gxse(ldlcse) ivw

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. * mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, gxse(ldlcse) penweighte
> d // TODO bugfix
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, gxse(ldlcse) ///
>         ivw penweighted

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .4650819   .0399012    11.66   0.000      .386877    .5432867
------------------------------------------------------------------------------

. 
. * testing less than 3 observations error message        
. rcof "mregger chdbeta ldlcbeta [aw=1/(chdse^2)] in 1/2" == 2001 

. rcof "mregger chdbeta ldlcbeta [aw=1/(chdse^2)] in 1" == 2001 

. 
. // radial IVW
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ivw radial

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |   .4815055   .0597994     8.05   0.000     .3643009    .5987101
------------------------------------------------------------------------------

. assert abs(_b[radialGP] - .482) < 1e-3

. assert abs(_se[radialGP] - 0.059) < 1e-3

. 
. // radial IVW fe SEs
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ivw radial fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |   .4815055    .038221    12.60   0.000     .4065938    .5564173
------------------------------------------------------------------------------

. assert abs(_b[radialGP] - .482) < 1e-3

. assert abs(_se[radialGP] - .038) < 1e-3

. eret list

scalars:
               e(df_r) =  .
                e(phi) =  1
                  e(k) =  73

macros:
            e(cmdline) : "mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==.."
                e(cmd) : "mregger"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 1
                  e(V) :  1 x 1

. 
. // radial IVW re
. /*
> mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ivw radial re
> //assert abs(_b[radialGP] - .417) < 1e-3
> //assert abs(_se[radialGP] - .076) < 1e-3
> eret list
> */
. 
. // radial MR-Egger
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |    .642582   .1157871     5.55   0.000     .4156434    .8695205
       _cons |  -.5737301   .3545658    -1.62   0.106    -1.268666    .1212062
------------------------------------------------------------------------------
                                               Residual standard error:  1.547

. assert abs(_b[radialGP] - .642) < 1e-3

. assert abs(_se[radialGP] - .115) < 1e-3

. assert abs(_b[_cons] - -.573) < 1e-3

. assert abs(_se[_cons] - .354) < 1e-3

. 
. // radial MR-Egger fe
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial fe

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |    .642582   .0748328     8.59   0.000     .4959124    .7892515
       _cons |  -.5737301   .2291547    -2.50   0.012    -1.022865   -.1245952
------------------------------------------------------------------------------
                                                    Residual standard error: 1

. assert abs(_b[radialGP] - .642) < 1e-3

. assert abs(_se[radialGP] - .074) < 1e-3

. assert abs(_b[_cons] - -.573) < 1e-3

. assert abs(_se[_cons] - .229) < 1e-3

. 
. // radial MR-Egger re
. /*
> mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial re
> assert abs(_b[radialGP] - .623) < 1e-3
> assert abs(_se[radialGP] - .106) < 1e-3
> assert abs(_b[_cons] - -.523) < 1e-3
> assert abs(_se[_cons] - .342) < 1e-3
> */
. 
. // disallow penweighted and radial for now
. rcof "noi mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial penweigh
> ted" ///
>         == 198
Options radial and penweighted currently not supported.

. 
. // mregger with radial formulation and tdist
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial tdist

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |    .642582   .1157871     5.55   0.000     .4117091    .8734549
       _cons |  -.5737301   .3545658    -1.62   0.110    -1.280714    .1332541
------------------------------------------------------------------------------
                                               Residual standard error:  1.547

. assert abs(_b[radialGP] - .642) < 1e-3

. assert abs(_se[radialGP] - .115) < 1e-3

. assert abs(_b[_cons] - -.573) < 1e-3

. assert abs(_se[_cons] - .354) < 1e-3

. 
. // radial and heterogi
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial heterogi
Heterogeneity/pleiotropy statistics:
------------------------------------------------------
Statistic |       Estimate        [95% Conf. Interval]
----------+-------------------------------------------
        H |          1.5               1.4    1.8     
      I^2 |          58                 46    68      
------------------------------------------------------
Q-test = 169.97877 d.f. = 71 p-value = 0.0000

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |    .642582   .1157871     5.55   0.000     .4156434    .8695205
       _cons |  -.5737301   .3545658    -1.62   0.106    -1.268666    .1212062
------------------------------------------------------------------------------
                                               Residual standard error:  1.547

. assert abs(e(Q) - 169.97) < 1e-2

. 
. // radial and i2gx
. mregger chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, radial gxse(ldlcse)
                                            Q_GX statistic (weighted): 3454.26
                                          I^2_GX statistic (weighted):  97.92%

                                                      Number of genotypes = 73
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
radialGD     |
    radialGP |    .642582   .1157871     5.55   0.000     .4156434    .8695205
       _cons |  -.5737301   .3545658    -1.62   0.106    -1.268666    .1212062
------------------------------------------------------------------------------
                                               Residual standard error:  1.547

. //assert abs(e(Q) - 169.97) < 1e-2
. 
end of do-file
      name:  mregger
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mregger.log
  log type:  text
 closed on:  27 Jun 2020, 23:00:40
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mreggerplot
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mreggerplot.log
  log type:  text
 opened on:  27 Jun 2020, 23:00:40

. * mreggerplot testcode
. * 6jun2016
. 
. cscript mreggerplot adofiles mreggerplot mregger
--------------------------------------------------------------BEGIN mreggerplot

-> which mreggerplot, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mreggerplot.ado
*! version 0.1.0 Tom Palmer 06jun2016

-> which mregger, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mregger.ado
*! version 0.1.0 04jun2016 Tom Palmer

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, legend(off)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, legend(on)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, legend(on) nolci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, gpci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis gpci" 
> == 198
nomcis and gpci options may not be specified together

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, gpci nolci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci nomcis

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci nomcis 
> gpci" == 198
nomcis and gpci options may not be specified together

. 
. // test passing own legend
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         legend(order(5 "Instruments" 4 "95% CIs" 3 "MR-Egger" 2 "MR-Egger 95%
>  CI"))

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop gpci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop nomcis

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop nomci
> s gpci" == 198
nomcis and gpci options may not be specified together

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop nolci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop nolci gpci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, linetop nolci nomcis

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, gpci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci linetop

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline linetop

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ellipses

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ellipses erro
> rbars" == 198
Options ellipses and errorbars cannot both be specified

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ivw ellipses 
> errorbars" == 198
Options ellipses and errorbars cannot both be specified

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, egger median"
>  == 198
only one of options egger or median allowed

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, egger

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ivw

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, median

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse, weighted" == 198
Please specify median with weighted or penweighted options

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse, penweighted" == 198
Please specify median with weighted or penweighted options

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, median weighted

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, median penweighted

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse, ivw median" == 198
only one of options ivw or median allowed

. 
. rcof "n mreggerplot chdbeta chdse ldlcbeta ldlcse, ivw egger" == 198
only one of options ivw or egger allowed

. 
. rcof "n mreggerplot chdbeta chdse ldlcbeta ldlcse, median egger" == 198
only one of options egger or median allowed

. 
. rcof "n mreggerplot chdbeta chdse ldlcbeta ldlcse, median egger ivw" == 198
only one of options ivw or egger allowed

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline egger

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline ivw

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline ivw linetop

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline median

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline median weighted

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, noline median penweight
> ed

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci egger

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci ivw

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis ivw

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis median

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, legend(off)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis nolci legend(off
> )

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ellipses legend(off)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ellipses legend(off) li
> netop

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ellipses legend(off) no
> mcis

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nomcis

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, wmarkers

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, wmarkers egger

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, wmarkers median

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, wmarkers median weighte
> d

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, wmarkers median penweig
> hted

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, level(50)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, level(99)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, mlabel(rsid)

. 
. ** add ivw line to egger plot
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1

. mregger chdbeta ldlcbeta [aw=1/(chdse^2)], ivw

                                                     Number of genotypes = 185
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
chdbeta      |
    ldlcbeta |   .5042238    .058028     8.69   0.000     .3904911    .6179565
------------------------------------------------------------------------------

. addplot : function _b[ldlcbeta]*x, range(0 0.5) lc(gs0) lp(dash)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, legend(off)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse in 1/3, ellipses

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ellipses

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ivw ellipses legend(off
> )

. 
. // titles
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, title("MR-Egger plot")

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, title(MR-Egger plot) //
> /
>         subtitle(Using MR-Base data)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         xtitle("Genotype-phenotype associations")

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         ytitle("Genotype-disease associations")

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         mleglabel(Genotypes)

. 
. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         mleglabel("Genotypes")

. 
. rcof "noi mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, errorbars ell
> ipses" == 198
Options ellipses and errorbars cannot both be specified

. 
. // example labelling some points
. cap noi drop mlabvar
variable mlabvar not found

. gen mlabvar = rsid if abs(ldlcbeta) > .3
(183 missing values generated)

. mreggerplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nolci ///
>         mlab(mlabvar) mlabsize(vsmall) mlabp(10) mlabc(gs0)

. 
end of do-file
      name:  mreggerplot
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mreggerplot.log
  log type:  text
 closed on:  27 Jun 2020, 23:02:02
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mreggersimex
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mreggersimex.log
  log type:  text
 opened on:  27 Jun 2020, 23:02:02

. * cscript for mreggersimex
. * 23jul2017
. 
. cscript mreggersimex adofiles mreggersimex mreggersimexonce
-------------------------------------------------------------BEGIN mreggersimex

-> which mreggersimex, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mreggersimex.ado
*! 0.1.0 20jul2017 Tom Palmer

-> which mreggersimexonce, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mreggersimexonce.ado
*! 0.1.0 23jul2017 Tom Palmer

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. mreggersimex chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ///
>         gxse(ldlcse) seed(12345)
(running mreggersimexonce on estimation sample)

Bootstrap replications (25)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
.........................

                                                      Number of genotypes = 73
                                                   Bootstrap replications = 25
                                                  Simulation replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6256194   .1166245     5.36   0.000     .3970396    .8541991
       _cons |  -.0089987   .0062257    -1.45   0.148    -.0212009    .0032035
------------------------------------------------------------------------------

. mat li r(table)

r(table)[9,2]
             slope       _cons
     b   .62561937  -.00899868
    se   .11662446   .00622571
     z   5.3643922  -1.4454055
pvalue   8.122e-08   .14834403
    ll   .39703962  -.02120085
    ul   .85419912   .00320349
    df           .           .
  crit    1.959964    1.959964
 eform           0           0

. 
. mreggersimex chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ///
>         gxse(ldlcse) seed(12345) simreps(20) reps(3)
(running mreggersimexonce on estimation sample)

Bootstrap replications (3)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...

                                                      Number of genotypes = 73
                                                    Bootstrap replications = 3
                                                  Simulation replications = 20
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6396257   .0485306    13.18   0.000     .5445074     .734744
       _cons |   -.009941   .0061239    -1.62   0.105    -.0219436    .0020616
------------------------------------------------------------------------------

. 
. mreggersimex chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ///
>         gxse(ldlcse) seed(12345) simreps(10)
(running mreggersimexonce on estimation sample)

Bootstrap replications (25)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
.........................

                                                      Number of genotypes = 73
                                                   Bootstrap replications = 25
                                                  Simulation replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6047862   .1314017     4.60   0.000     .3472436    .8623287
       _cons |  -.0079552   .0053891    -1.48   0.140    -.0185177    .0026073
------------------------------------------------------------------------------

. 
. mreggersimex chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ///
>         gxse(ldlcse) seed(12345) simreps(10) nodraw noboot

                                                      Number of genotypes = 73
                                                    Bootstrap replications = 0
                                                  Simulation replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6047862          .        .       .            .           .
       _cons |  -.0079552          .        .       .            .           .
------------------------------------------------------------------------------

. mreggersimex

                                                      Number of genotypes = 73
                                                    Bootstrap replications = 0
                                                  Simulation replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6047862          .        .       .            .           .
       _cons |  -.0079552          .        .       .            .           .
------------------------------------------------------------------------------

. mat li r(table)

r(table)[9,2]
             slope       _cons
     b   .60478616  -.00795516
    se           .           .
     z           .           .
pvalue           .           .
    ll           .           .
    ul           .           .
    df           .           .
  crit    1.959964    1.959964
 eform           0           0

. 
. mreggersimex chdbeta ldlcbeta [aw=1/chdse^2] if sel1==1, ///
>         gxse(ldlcse) seed(12345) simreps(10) nodraw
(running mreggersimexonce on estimation sample)

Bootstrap replications (25)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
.........................

                                                      Number of genotypes = 73
                                                   Bootstrap replications = 25
                                                  Simulation replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       slope |   .6047862   .1314017     4.60   0.000     .3472436    .8623287
       _cons |  -.0079552   .0053891    -1.48   0.140    -.0185177    .0026073
------------------------------------------------------------------------------

. mat li r(table)

r(table)[9,2]
             slope       _cons
     b   .60478616  -.00795516
    se   .13140166   .00538913
     z   4.6025762  -1.4761482
pvalue   4.173e-06   .13990412
    ll   .34724364  -.01851767
    ul   .86232869   .00260735
    df           .           .
  crit    1.959964    1.959964
 eform           0           0

. 
end of do-file
      name:  mreggersimex
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mreggersimex.log
  log type:  text
 closed on:  27 Jun 2020, 23:07:04
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrforest
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrforest.log
  log type:  text
 opened on:  27 Jun 2020, 23:07:04

. * mrforest cscript
. * 16jun2017
. 
. cscript mrforest adofiles mrforest
-----------------------------------------------------------------BEGIN mrforest

-> which mrforest, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrforest.ado
*! version 0.1.0 Tom Palmer 15jun2017

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) 

. 
. mrforest chdbeta chdse ldlcbeta ldlcse

. 
. mrforest chdbeta chdse ldlcbeta ldlcse if sel1==1, ivid(rsid)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) nostats

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/45, ivid(rsid) nostats

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/45, ivid(rsid)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse if sel1==1, ivid(rsid) nostats

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) modelsonly

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         modelsonly modelslabel(" ")

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         modelsonly modelslabel(" ") models(4)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         modelsonly modelslabel(" ") models(4) nostats

. 
. // change Genotypes Summary labels
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         ividlabel("Instruments") modelslabel("All instruments")

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         ividlabel(Instruments) modelslabel(All instruments)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         ividlabel("Instruments") models(0)      

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         ividlabel(Instruments) models(0)      

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) nonote

. 
. // check making horizontal bars grey (as per MR-Base) - metan has bugs
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         ciopt(lc(gray)) pointopt(mc(gray))

. 
. // change estimate label
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) effect(IV est)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse if sel1==1, ivid(rsid) ///
>         note("I{sub:GX}{sup:2}=90%", size(vsmall))

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         note("{it:I{sub:GX}{sup:2}}=90%", size(vsmall))

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) level(90)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, zcis ivid(rsid)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, eform ivid(rsid)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) gsort(unsorted)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) gsort(descending)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         models(0)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         models(1)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         models(2)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         models(3)    

.         
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         models(4)

. 
. rcof "noi mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) models(5
> )" == 198
models(#) should be between 0 and 4

. 
. mrforest chdbeta chdse ldlcbeta ldlcse in 1/10, ivid(rsid) ///
>         xlabel(-3,-2,-1,0,1,2,3)

. 
. mrforest chdbeta chdse ldlcbeta ldlcse if sel1==1, ivid(rsid)

. 
end of do-file
      name:  mrforest
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrforest.log
  log type:  text
 closed on:  27 Jun 2020, 23:07:48
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrfunnel
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrfunnel.log
  log type:  text
 opened on:  27 Jun 2020, 23:07:48

. * mrfunnel testcode
. * 29aug2017
. 
. cscript mrfunnel adofiles mrfunnel
-----------------------------------------------------------------BEGIN mrfunnel

-> which mrfunnel, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrfunnel.ado
*! 0.1.0 Tom Palmer 29aug2017

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata.dta, clear

. 
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. // web figure a2 of bowden et al., gen epi, 2016
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, metric(gpbeta)

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, metric(gpbetastd)

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, metric(invse)

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, noivw

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, nomregger

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, noivw nomregger

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, xscale(range(-4 4))

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, yscale(range(0 .6))

. 
. mrfunnel chdbeta chdse ldlcbeta ldlcse if sel1==1, mc(red)

. 
end of do-file
      name:  mrfunnel
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrfunnel.log
  log type:  text
 closed on:  27 Jun 2020, 23:07:58
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrivests
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrivests.log
  log type:  text
 opened on:  27 Jun 2020, 23:07:58

. * mrivests testcode
. * 10jun2017
. 
. cscript mrivests adofiles mrivests
-----------------------------------------------------------------BEGIN mrivests

-> which mrivests, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrivests.ado
*! 0.1.0 Tom Palmer 10jun2017

. 
. use https://raw.github.com/remlapmot/mrmedian/master/dodata, clear

. 
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. cap noi drop ivest
variable ivest not found

. cap noi drop ivse
variable ivse not found

. cap noi drop ivcilow
variable ivcilow not found

. cap noi drop ivciupp
variable ivciupp not found

. mrivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest ivse)

. list chdbeta ldlcbeta ivest ivse if sel1 == 1 

     +---------------------------------------------+
     | chdbeta   ldlcbeta        ivest        ivse |
     |---------------------------------------------|
  1. |   -.012      -.033    .36363636   .41620702 |
  3. |    -.15       -.38    .39473684   .25490917 |
  5. |    .017      -.049   -.34693878   .30920825 |
  6. |    .012       .034    .35294118   .50182759 |
  8. |    .094        .16        .5875   .10896331 |
     |---------------------------------------------|
  9. |   -.028      -.025         1.12    .7794674 |
 10. |   .0027       .033    .08181818    .6512335 |
 14. |    -.02      -.035    .57142857    .4708164 |
 15. |    .031      -.027   -1.1481481   .60441559 |
 18. | -.00064       .039   -.01641026   .32720366 |
     |---------------------------------------------|
 19. |    .035        .12    .29166667   .12866374 |
 20. |   -.064       -.14    .45714286   .13857242 |
 23. |    .061       .081    .75308642   .20613461 |
 24. |   -.026      -.044    .59090909   .49622191 |
 25. |    .017       .024    .70833333   .63882799 |
     |---------------------------------------------|
 26. |    .032       .049    .65306122   .52827715 |
 28. |   -.012       .038   -.31578947   .57251613 |
 31. |   .0073      -.022   -.33181818   .63534638 |
 33. |    .034      -.024   -1.4166667   .81148211 |
 36. |   -.018      -.027    .66666667   .53961236 |
     |---------------------------------------------|
 42. |    .066       .036    1.8333333   .67478764 |
 56. |    .033       .073    .45205479   .19569175 |
 57. |  -.0075       .028   -.26785714   .49836395 |
 58. |   -.021      -.046    .45652174   .31941662 |
 59. |  -.0038       .033   -.11515152   .47912213 |
     |---------------------------------------------|
 60. |   -.026      -.062    .41935484   .48081602 |
 61. |    -.03      -.025          1.2   .66578123 |
 65. |   -.019      -.026    .73076923   .54232303 |
 69. |   -.029      -.033    .87878788    .4746156 |
 70. |   -.061      -.048    1.2708333    .4163122 |
     |---------------------------------------------|
 74. |   .0074      -.034   -.21764706   .49548445 |
 75. |   -.033      -.039    .84615385   .71267178 |
 76. |   -.021      -.049    .42857143   .54478034 |
 77. |   -.025      -.036    .69444444   .41216408 |
 84. |    .021       .067    .31343284   .37355838 |
     |---------------------------------------------|
 90. |    .012       .032         .375    .5218211 |
 91. |   .0055      -.034   -.16176471   .43538977 |
 93. |   .0079      -.031   -.25483871   .50069586 |
 95. |   -.041      -.031    1.3225806   .58119538 |
 96. |   -.056      -.055    1.0181818   .26260861 |
     |---------------------------------------------|
 98. |   -.011       .034   -.32352941   .42055764 |
 99. |    .035       .045    .77777778   .59390933 |
102. |   -.014       -.03    .46666667   .57055045 |
104. |    .027       .033    .81818182   .44522452 |
105. |   -.098      -.067    1.4626866   .29194752 |
     |---------------------------------------------|
110. |  -.0076        .03   -.25333333   .52697317 |
113. |    .044       .032        1.375    .5184742 |
118. |   .0097       .035    .27714286   .65118302 |
119. |   .0019       .053    .03584906   .28529487 |
122. |     .13       .076    1.7105263   .39438127 |
     |---------------------------------------------|
125. |    .053       .059    .89830508   .38022375 |
130. |   -.077       .023   -3.3478261   .89866233 |
131. |   -.055       .028   -1.9642857   .71121562 |
133. |    -.07      -.038    1.8421053   .44088432 |
136. |       0       .024            0   .81812583 |
     |---------------------------------------------|
138. |   -.018        .03          -.6   .65987182 |
149. |     .01       .028    .35714286   .70195318 |
152. |   -.022      -.029    .75862069   .48524242 |
153. |     .04       .065    .61538462   .28687071 |
155. |     .01       .024    .41666667   .60713808 |
     |---------------------------------------------|
159. |   -.015       -.03           .5   .51730751 |
166. |    -.13       -.22    .59090909   .15971814 |
167. |    .056       .054     1.037037   .27040742 |
168. |     .11        .12    .91666667   .25274108 |
171. |    .019       .084    .22619048   .24225171 |
     |---------------------------------------------|
172. |    -.14       -.49    .28571429   .16869525 |
173. |   -.001      -.029    .03448276   .54992355 |
176. |  -.0072      -.025         .288   .56630601 |
177. |   .0053       -.03   -.17666667   .93462326 |
179. |    .016       .036    .44444444   .40555348 |
     |---------------------------------------------|
180. |   -.019      -.042    .45238095   .33204249 |
181. |     .03      -.069   -.43478261   .63341594 |
184. |  -.0097       .077   -.12597403   .66640612 |
     +---------------------------------------------+

. assert abs(ivest[1] - .36363636) < 1e-8

. assert abs(ivse[1] - .41620702) < 1e-8

. assert abs(ivest[184] - -.12597403) < 1e-8

. assert abs(ivse[184] - .66640612) < 1e-8

. gen double ivcilow = ivest - 1.96*ivse
(112 missing values generated)

. gen double ivciupp = ivest + 1.96*ivse
(112 missing values generated)

. di ivcilow[1], ivciupp[1]
-.45212939 1.1794021

. 
. cap noi drop ivest

. cap noi drop ivse

. qui gen double ivest = 100

. qui gen double ivse = 10

. mrivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest ivse, repla
> ce)

. assert abs(ivest[1] - .36363636) < 1e-8

. assert abs(ivse[1] - .41620702) < 1e-8

. assert abs(ivest[184] - -.12597403) < 1e-8

. assert abs(ivse[184] - .66640612) < 1e-8

. 
. cap noi drop ivest

. cap noi drop ivse

. cap noi drop ivcilow

. cap noi drop ivciupp

. rcof "noi mrivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest i
> vse thr)" == 198
Please specify 2 variable names, which are for the IV estimates and their SEs.

. rcof "noi mrivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest)"
>  == 198
Please specify 2 variable names, which are for the IV estimates and their SEs.

. rcof "noi mrivests chdbeta chdse ldlcbeta if sel1==1, generate(ivest ivcilow 
> ivciupp) fieller" == 198
With 3 inputs please specify the nome option.

. 
. cap noi drop ivest

. cap noi drop ivse
variable ivse not found

. qui gen double ivest = 100

. qui gen double ivse = 10

. mrivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest ivse, repla
> ce) nome

. assert abs(ivest[1] - .36363636) < 1e-8

. assert abs(ivse[1] - .41421333) < 1e-8

. assert abs(ivest[184] - -.12597403) < 1e-8

. assert abs(ivse[184] - .66611182) < 1e-8

. 
. cap noi drop ivest

. cap noi drop ivcilow

. cap noi drop ivciupp

. mrivests chdbeta chdse ldlcbeta ldlcse if sel1==1, generate(ivest ivcilow ivc
> iupp) fieller

. assert abs(ivcilow[1] - -.45429758) < 1e-8

. assert abs(ivciupp[1] - 1.2183172) < 1e-7

. 
end of do-file
      name:  mrivests
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrivests.log
  log type:  text
 closed on:  27 Jun 2020, 23:08:01
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrmedian
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmedian.log
  log type:  text
 opened on:  27 Jun 2020, 23:08:01

. * mrmedian test code
. * 3jun2016
. 
. cscript mrmedian adofiles mrmedian
-----------------------------------------------------------------BEGIN mrmedian

-> which mrmedian, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmedian.ado
*! version 0.1.0 03jun2016 Tom Palmer

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. *** test error messages
. rcof "noi mrmedian chdbeta" == 102
too few variables specified

. rcof "noi mrmedian chdbeta chdse" == 102
too few variables specified

. rcof "noi mrmedian chdbeta chdse ldlcbeta" == 102
too few variables specified

. rcof "noi mrmedian chdbeta chdse ldlcbeta ldlcse hdlcbeta" == 103
too many variables specified

. 
. rcof "noi mrmedian chdbeta chdse ldlcbeta ldlcse, weighted penweighted" == 19
> 8
Specify both weighted and penweighted options is not allowed.

. 
. *** ldlc - analysis 1
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. ** unweighted median
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0700946     6.11   0.000     .2911886    .5659543
------------------------------------------------------------------------------

. assert abs(_b[beta] - .429) < 1e-3

. assert abs(_se[beta] - .07) < 1e-2

. mat list r(table)

r(table)[9,1]
             beta
     b  .42857143
    se  .07009459
     z  6.1141868
pvalue  9.705e-10
    ll  .29118855
    ul   .5659543
    df          .
  crit   1.959964
 eform          0

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0718147     5.97   0.000     .2878172    .5693257
------------------------------------------------------------------------------

. scalar b1 = _b[beta]

. scalar s1 = _se[beta]

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0718147     5.97   0.000     .2878172    .5693257
------------------------------------------------------------------------------

. assert abs(_b[beta] - scalar(b1)) < 1e-7

. assert abs(_se[beta] - scalar(s1)) < 1e-7

. 
. ** weighted median
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, weighted

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4582573   .0663262     6.91   0.000     .3282604    .5882543
------------------------------------------------------------------------------

. assert abs(_b[beta] - .458) < 1e-3

. assert abs(_se[beta] - .06) < 1e-2

. mat list r(table)

r(table)[9,1]
             beta
     b  .45825733
    se   .0663262
     z  6.9091453
pvalue  4.876e-12
    ll  .32826037
    ul  .58825428
    df          .
  crit   1.959964
 eform          0

. 
. ** penalized weighted
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, penweighted

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |    .456997   .0630115     7.25   0.000     .3334967    .5804973
------------------------------------------------------------------------------

. assert abs(_b[beta] - .457) < 1e-3

. assert abs(_se[beta] - .06) < 1e-2

. mat list r(table)

r(table)[9,1]
             beta
     b  .45699704
    se  .06301151
     z   7.252596
pvalue  4.089e-13
    ll  .33349674
    ul  .58049733
    df          .
  crit   1.959964
 eform          0

. 
. *** test ereturn results
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0717656     5.97   0.000     .2879134    .5692295
------------------------------------------------------------------------------

. assert e(cmd) == "mrmedian"

. assert e(cmdline) == "mrmedian chdbeta chdse ldlcbeta ldlcse if sel1"

. assert e(k) == 73

. assert e(properties) == "b V"

. 
. *** test in condition
. gen int order = _n

. gsort -sel1

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse in 1/73, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0717832     5.97   0.000      .287879    .5692639
------------------------------------------------------------------------------

. scalar b2 = _b[beta]

. scalar s2 = _se[beta]

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse in 1/73, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0717832     5.97   0.000      .287879    .5692639
------------------------------------------------------------------------------

. assert e(k) == 73

. assert abs(_b[beta] - scalar(b2)) < 1e-7

. assert abs(_se[beta] - scalar(s2)) < 1e-7

. 
. *** test reps option
. sort order

. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345) reps(50)

                                                      Number of genotypes = 73
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0825383     5.19   0.000     .2667993    .5903436
------------------------------------------------------------------------------

. scalar b3 = _b[beta]

. scalar s3 = _se[beta]

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345) reps(50)

                                                      Number of genotypes = 73
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0825383     5.19   0.000     .2667993    .5903436
------------------------------------------------------------------------------

. assert abs(_b[beta] - scalar(b3)) < 1e-7

. assert abs(_se[beta] - scalar(s3)) < 1e-7

. 
. *** test replay
. discard

. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0709576     6.04   0.000     .2894971    .5676458
------------------------------------------------------------------------------

. mrmedian

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0709576     6.04   0.000     .2894971    .5676458
------------------------------------------------------------------------------

. 
. *** test by: fails with error
. rcof "bysort a2: mrmedian chdbeta chdse ldlcbeta ldlcse if sel1" == 190

. 
. *** test if and in give same SE with same seed and same sort order of the dat
> aset
. keep if sel1
(112 observations deleted)

. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0698985     6.13   0.000     .2915729    .5655699
------------------------------------------------------------------------------

. scalar b4 = _b[beta]

. scalar s4 = _se[beta]

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse in 1/73, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0698985     6.13   0.000     .2915729    .5655699
------------------------------------------------------------------------------

. assert abs(_b[beta] - scalar(b4)) < 1e-7

. assert abs(_se[beta] - scalar(s4)) < 1e-7

. 
. ** disallow 2 and 1 genotypes - although median is defined for N=1 and N=2
. rcof "mrmedian chdbeta chdse ldlcbeta ldlcse in 1/2" == 2001

. rcof "mrmedian chdbeta chdse ldlcbeta ldlcse in 1" == 2001

. 
. ** test level option
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345) level(95)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0698985     6.13   0.000     .2915729    .5655699
------------------------------------------------------------------------------

. assert abs(_b[beta] - .429) < 1e-3

. assert abs(_se[beta] - .07) < 1e-2

. mrmedian, level(90)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0698985     6.13   0.000     .3135987    .5435442
------------------------------------------------------------------------------

. 
. mrmedian chdbeta chdse ldlcbeta ldlcse if sel1, seed(12345) level(90)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0698985     6.13   0.000     .3135987    .5435442
------------------------------------------------------------------------------

. assert abs(_b[beta] - .429) < 1e-3

. assert abs(_se[beta] - .07) < 1e-2

. mrmedian, level(80)

                                                      Number of genotypes = 73
                                                           Replications = 1000
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [80% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4285714   .0698985     6.13   0.000     .3389929    .5181499
------------------------------------------------------------------------------

. 
end of do-file
      name:  mrmedian
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmedian.log
  log type:  text
 closed on:  27 Jun 2020, 23:08:04
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrmedianobs
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmedianobs.log
  log type:  text
 opened on:  27 Jun 2020, 23:08:04

. * mrmedianobs cscript
. * 4jun2016
. 
. cscript mrmedianobs adofiles mrmedianobs mrmedianobs_work
--------------------------------------------------------------BEGIN mrmedianobs

-> which mrmedianobs, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmedianobs.ado
*! version 0.1.0 04jun2016 Tom Palmer

-> which mrmedianobs_work, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmedianobs_work.ado
*! version 0.1.0 04jun2016 Tom Palmer

. 
. ** simulate data
. set seed 12345

. 
. set obs 1000
number of observations (_N) was 0, now 1,000

. local zformula

. forvalues i=1/20 {
  2.         gen int z`i' = rbinomial(2,`=runiform()')
  3. }

. egen double x = rowtotal(z*)

. replace x = x + rnormal()
(1,000 real changes made)

. gen double y = x + rnormal()

. 
. *** test replay
. mrmedianobs y (x = z*)

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0638845    15.63   0.000     .8734322    1.123855
------------------------------------------------------------------------------

. mrmedianobs

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0638845    15.63   0.000     .8734322    1.123855
------------------------------------------------------------------------------

. 
. *** test seed
. mrmedianobs y (x = z*), seed(3456)

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0698186    14.30   0.000     .8618015    1.135485
------------------------------------------------------------------------------

. scalar b1 = _b[beta]

. scalar s1 = _se[beta]

. mrmedianobs y (x = z*), seed(3456)

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 50
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0698186    14.30   0.000     .8618015    1.135485
------------------------------------------------------------------------------

. assert abs(_b[beta] - scalar(b1)) < 1e-7

. assert abs(_se[beta] - scalar(s1)) < 1e-7

. 
. *** test reps()
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345)
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0149929    66.61   0.000      .969258    1.028029
------------------------------------------------------------------------------

. scalar b2 = _b[beta]

. scalar s2 = _se[beta]

. 
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345)
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0149929    66.61   0.000      .969258    1.028029
------------------------------------------------------------------------------

. assert abs(_b[beta] - scalar(b2)) < 1e-7

. assert abs(_se[beta] - scalar(s2)) < 1e-7

. mat list r(table)

r(table)[9,1]
             beta
     b  .99864349
    se  .01499286
     z  66.607959
pvalue          0
    ll  .96925803
    ul  1.0280289
    df          .
  crit   1.959964
 eform          0

. 
. mrmedianobs

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0149929    66.61   0.000      .969258    1.028029
------------------------------------------------------------------------------

. 
. *** test weights
. mrmedianobs y (x = z*), reps(10) seed(12345) weighted

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9987268   .0901623    11.08   0.000      .822012    1.175442
------------------------------------------------------------------------------

. mat list r(table)

r(table)[9,1]
             beta
     b   .9987268
    se  .09016228
     z  11.076992
pvalue  1.622e-28
    ll  .82201199
    ul  1.1754416
    df          .
  crit   1.959964
 eform          0

. 
. mrmedianobs y (x = z*), reps(10) seed(12345) penweighted

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9987268   .0901623    11.08   0.000      .822012    1.175442
------------------------------------------------------------------------------

. mat list r(table)

r(table)[9,1]
             beta
     b   .9987268
    se  .09016228
     z  11.076992
pvalue  1.622e-28
    ll  .82201199
    ul  1.1754416
    df          .
  crit   1.959964
 eform          0

. 
. *** test obsboot and weights
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345)
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0149929    66.61   0.000      .969258    1.028029
------------------------------------------------------------------------------

. 
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345)
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0149929    66.61   0.000      .969258    1.028029
------------------------------------------------------------------------------

. 
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345) weighted
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9987268   .0203573    49.06   0.000     .9588273    1.038626
------------------------------------------------------------------------------

. 
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345) penweighted
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9987268   .0203573    49.06   0.000     .9588273    1.038626
------------------------------------------------------------------------------

. 
. *** test percentile ci limits
. mrmedianobs y (x = z*), obsboot reps(10) seed(12345) all
(running mrmedianobs_work on estimation sample)

Bootstrap replications (10)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..........
------------------------------------------------------------------------------
             |    Observed               Bootstrap
             |       Coef.       Bias    Std. Err.  [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .99864349  -.0014599   .01499286     .969258   1.028029   (N)
             |                                       .9654705   1.018876   (P)
             |                                       .9654705   1.018876  (BC)
------------------------------------------------------------------------------
(N)    normal confidence interval
(P)    percentile confidence interval
(BC)   bias-corrected confidence interval

                                                      Number of genotypes = 20
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9986435   .0149929    66.61   0.000      .969258    1.028029
------------------------------------------------------------------------------

. mat list r(table)

r(table)[9,1]
             beta
     b  .99864349
    se  .01499286
     z  66.607959
pvalue          0
    ll  .96925803
    ul  1.0280289
    df          .
  crit   1.959964
 eform          0

. 
. rcof "mrmedianobs y (x = z*), reps(10) seed(12345) all" == 198

. 
. rcof "mrmedianobs y (x = z1-z2), reps(10) seed(12345)" == 2001

. rcof "mrmedianobs y (x = z1), reps(10) seed(12345)" == 2001

. rcof "mrmedianobs y (x = z1-z20) in 1/2, reps(10) seed(12345)" == 2001

. rcof "mrmedianobs y (x = z1-z20) in 1, reps(10) seed(12345)" == 2001

. 
. mrmedianobs y (x = z1-z3), reps(10) seed(12345) level(90)

                                                       Number of genotypes = 3
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9913514   .0979108    10.13   0.000     .8303024      1.1524
------------------------------------------------------------------------------

. mrmedianobs, level(95)

                                                       Number of genotypes = 3
                                                          Number of obs = 1000
                                                             Replications = 10
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .9913514   .0979108    10.13   0.000     .7994497    1.183253
------------------------------------------------------------------------------

. 
end of do-file
      name:  mrmedianobs
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmedianobs.log
  log type:  text
 closed on:  27 Jun 2020, 23:08:26
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrmodal
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmodal.log
  log type:  text
 opened on:  27 Jun 2020, 23:08:26

. * mrmodal cscript
. * 2jun2017
. 
. cscript mrmodal adofiles mrmodal
------------------------------------------------------------------BEGIN mrmodal

-> which mrmodal, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmodal.ado
*! version 0.1.0 02jun2017 Tom Palmer

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. ** error messages
. 
. ** estimation examples
. ** ldlc
. 
. gen byte sel1 = 1 if ldlcp2 < 1e-8
(112 missing values generated)

. count if sel1 == 1
  73

. gen double BetaYG = chdbeta

. gen double BetaXG = ldlcbeta

. gen double seBetaYG = chdse

. gen double seBetaXG = ldlcse

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4917353) < 1e-7

. mat list r(table)

r(table)[9,1]
             beta
     b  .49173529
    se  .13564316
     z  3.6252126
pvalue  .00028872
    ll  .22587958
    ul  .75759099
    df          .
  crit   1.959964
 eform          0

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, seed(12345) level(90)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2686221    .7148484
------------------------------------------------------------------------------

. mat list r(table)

r(table)[9,1]
             beta
     b  .49173529
    se  .13564316
     z  3.6252126
pvalue  .00028872
    ll  .26862215
    ul  .71484843
    df          .
  crit  1.6448536
 eform          0

. 
. mrmodal

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodal, level(90)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2686221    .7148484
------------------------------------------------------------------------------

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, phi(.5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1857483     2.27   0.023     .0578068    .7859267
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4218667) < 1e-7

. mat list r(table)

r(table)[9,1]
             beta
     b  .42186675
    se  .18574827
     z  2.2711745
pvalue  .02313642
    ll  .05780682
    ul  .78592668
    df          .
  crit   1.959964
 eform          0

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, phi(.25)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2261642     1.86   0.063    -.0234025     .863145
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4198713) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, weighted

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0674841     7.10   0.000     .3467038    .6112366
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4789702) < 1e-7

. mat list r(table)

r(table)[9,1]
             beta
     b   .4789702
    se  .06748411
     z  7.0975258
pvalue  1.270e-12
    ll  .34670378
    ul  .61123663
    df          .
  crit   1.959964
 eform          0

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, phi(.5) weighted

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4906313   .1151202     4.26   0.000     .2649999    .7162626
------------------------------------------------------------------------------

. assert abs(_b[beta] -.4906313) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, phi(.25) weighted

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5820001   .1364848     4.26   0.000     .3144948    .8495054
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5820001) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, nome

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1319598     3.73   0.000     .2330988    .7503717
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4917353) < 1e-7

. mat list r(table)

r(table)[9,1]
             beta
     b  .49173529
    se   .1319598
     z  3.7264023
pvalue  .00019423
    ll  .23309884
    ul  .75037174
    df          .
  crit   1.959964
 eform          0

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, phi(.5) nome

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1893127     2.23   0.026     .0508207    .7929128
------------------------------------------------------------------------------

. assert abs(_b[beta] -.4218667) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, phi(.25) nome

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2233716     1.88   0.060    -.0179291    .8576716
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4198713) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, weighted nome

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0702727     6.82   0.000     .3412382    .6167022
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4789702) < 1e-7

. mat list r(table)

r(table)[9,1]
             beta
     b   .4789702
    se  .07027274
     z  6.8158749
pvalue  9.369e-12
    ll  .34123817
    ul  .61670224
    df          .
  crit   1.959964
 eform          0

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, weighted nome phi(.5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4906313   .1117767     4.39   0.000      .271553    .7097095
------------------------------------------------------------------------------

. assert abs(_b[beta] - .4906313) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel1==1, weighted nome phi(.25)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5820001   .1333661     4.36   0.000     .3206073    .8433929
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5820001) < 1e-7

. 
. ** hdlc example
. 
. gen byte sel2 = 1 if hdlcp2 < 1e-8
(100 missing values generated)

. count if sel2 == 1
  85

. cap noi drop BetaYG

. cap noi drop seBetaYG

. cap noi drop BetaXG

. cap noi drop seBetaXG

. gen double BetaYG = chdbeta

. gen double BetaXG = hdlcbeta

. gen double seBetaYG = chdse

. gen double seBetaXG = hdlcse

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, seed(12345)

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.1340609   .1460344    -0.92   0.359    -.4202831    .1521613
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.13406091) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.5) seed(12345)

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.1742257   .2179792    -0.80   0.424    -.6014572    .2530057
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.174225711) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.25) seed(12345)

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.2538561   .2561904    -0.99   0.322      -.75598    .2482678
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.253856075) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, seed(12345) weighted 

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |    -.02958     .06483    -0.46   0.648    -.1566444    .0974844
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.02957998) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.5) seed(12345) weigh
> ted 

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.0028893   .0891113    -0.03   0.974    -.1775442    .1717655
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.002889325) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.25) seed(12345) weig
> hted 

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.0205773   .1149965    -0.18   0.858    -.2459663    .2048117
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.020577298) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, seed(12345) nome

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.1340609   .1488509    -0.90   0.368    -.4258033    .1576815
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.13406091) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.5) seed(12345) nome

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.1742257   .2186466    -0.80   0.426    -.6027652    .2543137
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.174225711) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.25) seed(12345) nome

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.2538561   .2619731    -0.97   0.333     -.767314    .2596019
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.253856075) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, seed(12345) weighted nome

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |    -.02958   .0650554    -0.45   0.649    -.1570863    .0979264
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.02957998) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.5) seed(12345) nome 
> weighted 

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.0028893   .0894804    -0.03   0.974    -.1782676    .1724889
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.002889325) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel2==1, phi(.25) seed(12345) nome
>  weighted 

                                                      Number of genotypes = 85
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |  -.0205773   .1162931    -0.18   0.860    -.2485076     .207353
------------------------------------------------------------------------------

. assert abs(_b[beta] - -.020577298) < 1e-8

. 
. ** tg example
. 
. gen byte sel3 = 1 if tgp2 < 1e-8
(138 missing values generated)

. count if sel3 == 1
  47

. cap noi drop BetaYG

. cap noi drop seBetaYG

. cap noi drop BetaXG

. cap noi drop seBetaXG

. gen double BetaYG = chdbeta

. gen double BetaXG = tgbeta

. gen double seBetaYG = chdse

. gen double seBetaXG = tgse

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, seed(12345)

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .6835468   .1856822     3.68   0.000     .3196164    1.047477
------------------------------------------------------------------------------

. assert abs(_b[beta] - .6835468) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.5) seed(12345)

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .8170654   .2666853     3.06   0.002     .2943718    1.339759
------------------------------------------------------------------------------

. assert abs(_b[beta] - .8170654) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.25) seed(12345)

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .8826142   .3138704     2.81   0.005     .2674395    1.497789
------------------------------------------------------------------------------

. assert abs(_b[beta] - .8749913) < 1e-2

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, seed(12345) weighted 

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5396388   .0868696     6.21   0.000     .3693774    .7099001
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5396388) < 1e-4

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.5) seed(12345) weigh
> ted 

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5788325   .1220253     4.74   0.000     .3396672    .8179977
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5788325) < 1e-6

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.25) seed(12345) weig
> hted 

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5472065   .1410463     3.88   0.000     .2707607    .8236522
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5472065) < 1e-6

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, seed(12345) nome

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .6835468   .1847678     3.70   0.000     .3214085    1.045685
------------------------------------------------------------------------------

. assert abs(_b[beta] - .6835468) < 1e-8

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.5) seed(12345) nome

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .8170654   .2659087     3.07   0.002     .2958939    1.338237
------------------------------------------------------------------------------

. assert abs(_b[beta] - .8170654) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.25) seed(12345) nome

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .8826142   .3240802     2.72   0.006     .2474287      1.5178
------------------------------------------------------------------------------

. assert abs(_b[beta] - .8479913) < 1e-1

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, seed(12345) weighted nome

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5499179   .0862447     6.38   0.000     .3808813    .7189545
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5499179) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.5) seed(12345) nome 
> weighted 

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5788325   .1207149     4.80   0.000     .3422355    .8154294
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5788325) < 1e-7

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.25) seed(12345) nome
>  weighted 

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5472065   .1390793     3.93   0.000     .2746162    .8197968
------------------------------------------------------------------------------

. assert abs(_b[beta] - .5472065) < 1e-7

. 
. ** nosave option
. mata mata clear

. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.5) seed(12345) weigh
> ted

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5788325   .1220253     4.74   0.000     .3396672    .8179977
------------------------------------------------------------------------------

. mata mata desc

      # bytes   type                        name and extent
-------------------------------------------------------------------------------
        4,096   real colvector              mrmodal_densityiv[512]
        4,096   real colvector              mrmodal_g[512]
-------------------------------------------------------------------------------

. 
. mata mata clear

. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, phi(.5) seed(12345) nosav
> e weighted

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5788325   .1220253     4.74   0.000     .3396672    .8179977
------------------------------------------------------------------------------

. cap noi mata mrmodal_densityiv
                 <istmt>:  3499  mrmodal_densityiv not found

. assert _rc == 3499

. cap noi mata mrmodal_g
                 <istmt>:  3499  mrmodal_g not found

. assert _rc == 3499

. 
. mrmodal BetaYG seBetaYG BetaXG seBetaXG if sel3==1, seed(12345)

                                                      Number of genotypes = 47
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .6835468   .1856822     3.68   0.000     .3196164    1.047477
------------------------------------------------------------------------------

. 
end of do-file
      name:  mrmodal
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmodal.log
  log type:  text
 closed on:  27 Jun 2020, 23:08:45
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrmodalplot
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmodalplot.log
  log type:  text
 opened on:  27 Jun 2020, 23:08:45

. * mrmodalplot example
. * 2aug2017
. 
. cscript mrmodalplot adofiles mrmodalplot
--------------------------------------------------------------BEGIN mrmodalplot

-> which mrmodalplot, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrmodalplot.ado
*! 0.1.0 2aug2017 Tom Palmer

. 
. use https://raw.github.com/remlapmot/mrrobust/master/dodata, clear

. 
. gen byte sel1 = (ldlcp2 < 1e-8)

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2197838     1.91   0.056     -.010897    .8506396
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1951393     2.16   0.031     .0394007    .8043328
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1430383     3.44   0.001     .2113853    .7720853
------------------------------------------------------------------------------

. 
. * Simple mode estimator
. mrmodal chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodal chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) nosave

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2267297     1.85   0.064    -.0245107    .8642533
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1981169     2.13   0.033     .0335647    .8101688
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) reps(100)

                                                      Number of genotypes = 73
                                                            Replications = 100
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2295545     1.83   0.067    -.0300472    .8697898
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                            Replications = 100
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .2011052     2.10   0.036     .0277078    .8160257
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                            Replications = 100
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1291764     3.81   0.000     .2385543    .7449163
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(.5 1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1981169     2.13   0.033     .0335647    .8101688
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(1 1.5 2
>  2.5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 1.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4782134   .0992971     4.82   0.000     .2835948    .6728321
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 2
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |    .438605   .0853427     5.14   0.000     .2713364    .6058735
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 2.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4229441   .0763672     5.54   0.000     .2732672     .572621
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(1) lc(g
> s0)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         seed(12345) lc(gs10 gs5 gs0)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2267297     1.85   0.064    -.0245107    .8642533
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1981169     2.13   0.033     .0335647    .8101688
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         seed(12345) lc(gs10 gs5 gs0) lp(solid dash longdash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2267297     1.85   0.064    -.0245107    .8642533
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1981169     2.13   0.033     .0335647    .8101688
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, ///
>         seed(12345) lc(gs10 gs5 gs0) lp(solid dash longdash) lw(vthin thin th
> ick)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2267297     1.85   0.064    -.0245107    .8642533
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1981169     2.13   0.033     .0335647    .8101688
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(1) lp(d
> ash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(1) lw(v
> thick)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, seed(12345) phi(1) ///
>         lc(gs0) lw(vthick) lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1356432     3.63   0.000     .2258796     .757591
------------------------------------------------------------------------------

. 
. * Weighted mode estimator
. mrmodal chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5820001   .1365403     4.26   0.000      .314386    .8496142
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4906313   .1149696     4.27   0.000      .265295    .7159676
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(.5 1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4906313   .1149696     4.27   0.000      .265295    .7159676
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(1 1.5 2 2.5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 1.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4782134   .0575822     8.30   0.000     .3653544    .5910725
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 2
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4847262   .0516013     9.39   0.000     .3835896    .5858628
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 2.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4729783    .048249     9.80   0.000      .378412    .5675447
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(1) lc(gs0)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(1) lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(1) lw(vthick)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted seed(12345) ph
> i(1) ///
>         lc(gs0) lw(vthick) lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0718135     6.67   0.000     .3382183    .6197221
------------------------------------------------------------------------------

. 
. * Simple mode estimator with NOME assumption
. mrmodal chdbeta chdse ldlcbeta ldlcse if sel1==1, nome

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1313224     3.74   0.000     .2343481    .7491225
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4198713   .2273152     1.85   0.065    -.0256584     .865401
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1953752     2.16   0.031     .0389384    .8047951
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(.5
>  1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4218667   .1953752     2.16   0.031     .0389384    .8047951
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(1 
> 1.5 2 2.5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 1.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4782134   .0991844     4.82   0.000     .2838156    .6726112
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 2
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |    .438605   .0849872     5.16   0.000     .2720331    .6051769
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 2.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4229441   .0761031     5.56   0.000     .2737847    .5721035
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(1)
>  lc(gs0)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(1)
>  lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(1)
>  lw(vthick)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome seed(12345) phi(1)
>  ///
>         lc(gs0) lw(vthick) lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4917353   .1354745     3.63   0.000     .2262101    .7572605
------------------------------------------------------------------------------

. 
. * Weighted mode estimator with NOME assumption
. mrmodal chdbeta chdse ldlcbeta ldlcse if sel1==1, weighted nome

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0674035     7.11   0.000     .3468618    .6110786
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = .25
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .5820001   .1351747     4.31   0.000     .3170626    .8469376
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4906313   .1144836     4.29   0.000     .2662474    .7150151
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(.5 1)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                      Phi = .5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4906313   .1144836     4.29   0.000     .2662474    .7150151
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(1 1.5 2 2.5)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 1.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4782134   .0574266     8.33   0.000     .3656593    .5907676
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 2
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4847262   .0513146     9.45   0.000     .3841513    .5853011
------------------------------------------------------------------------------

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                     Phi = 2.5
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4896564   .0477916    10.25   0.000     .3959865    .5833263
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(1) lc(gs0)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(1) lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(1) lw(vthick)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
. mrmodalplot chdbeta chdse ldlcbeta ldlcse if sel1==1, nome weighted seed(1234
> 5) phi(1) ///
>         lc(gs0) lw(vthick) lp(dash)

                                                      Number of genotypes = 73
                                                           Replications = 1000
                                                                       Phi = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   .4789702   .0712874     6.72   0.000     .3392495    .6186909
------------------------------------------------------------------------------

. 
end of do-file
      name:  mrmodalplot
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrmodalplot.log
  log type:  text
 closed on:  27 Jun 2020, 23:09:41
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  mrratio
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrratio.log
  log type:  text
 opened on:  27 Jun 2020, 23:09:41

. * mrratio cscript
. * 6jun2017
. 
. cscript mrratio adofiles mrratio
------------------------------------------------------------------BEGIN mrratio

-> which mrratio, usesysdir
C:\Users\tom\Documents\GitHub\mrrobust\mrratio.ado
*! 1.0.0 Tom Palmer 30may2017, based on my old tsci.ado from 8jan2010

. 
. // basic call
. mrratio 1 .5 1 .25

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1    .559017     1.79   0.074    -.0956532    2.095653
------------------------------------------------------------------------------

. eret list

scalars:
         e(fiellerres) =  .
              e(level) =  95

macros:
            e(cmdline) : "mrratio 1 .5 1 .25"
                e(cmd) : "mrratio"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 1
                  e(V) :  1 x 1

. assert _b[beta] == 1

. assert abs(_se[beta] - .559017) < 1e-6

. assert e(fiellerres) == .

. mat li r(table)

r(table)[9,1]
              beta
     b           1
    se   .55901699
     z   1.7888544
pvalue   .07363827
    ll  -.09565318
    ul   2.0956532
    df           .
  crit    1.959964
 eform           0

. 
. // test replay
. mrratio

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1    .559017     1.79   0.074    -.0956532    2.095653
------------------------------------------------------------------------------

. assert _b[beta] == 1

. assert abs(_se[beta] - .559017) < 1e-6

. assert e(level) == 95

. 
. mrratio, level(90)

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1    .559017     1.79   0.074     .0804989    1.919501
------------------------------------------------------------------------------

. 
. mrratio 1 .5 1 .25, eform

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.519566     1.79   0.074     .9087791     8.13075
------------------------------------------------------------------------------

. mat li r(table)

r(table)[9,1]
             beta
     b  2.7182818
    se  1.5195657
     z  1.7888544
pvalue  .07363827
    ll  .90877915
    ul    8.13075
    df          .
  crit   1.959964
 eform          1

. mrratio

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1    .559017     1.79   0.074    -.0956532    2.095653
------------------------------------------------------------------------------

. mrratio, eform

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.519566     1.79   0.074     .9087791     8.13075
------------------------------------------------------------------------------

. 
. mrratio 1 .5 1 .25, eform level(90)

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.519566     1.79   0.074     1.083828    6.817557
------------------------------------------------------------------------------

. mrratio, eform

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.519566     1.79   0.074     .9087791     8.13075
------------------------------------------------------------------------------

. mrratio, eform level(90)

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.519566     1.79   0.074     1.083828    6.817557
------------------------------------------------------------------------------

. 
. // fieller
. mrratio 1 .5 1 .25, fieller

Ratio estimate: 1
95% Fieller CI: [.0199692, 2.611926]

. eret list

scalars:
            e(lowerci) =  .0199691608403421
            e(upperci) =  2.611925531794721
         e(fiellerres) =  1
              e(level) =  95

macros:
            e(cmdline) : "mrratio 1 .5 1 .25, fieller"
                e(cmd) : "mrratio"
         e(properties) : "b"

matrices:
                  e(b) :  1 x 1

. assert e(fiellerres) == 1

. assert _b[beta] == 1

. assert abs(e(lowerci) - .019969) < 1e-6

. assert abs(e(upperci) - 2.611925) < 1e-6

. 
. mrratio

Ratio estimate: 1
95% Fieller CI: [.01996916, 2.6119255]

. 
. rcof "noi mrratio, level(90)" == 198

level() option not allowed with Fieller CI with estimates replay

. 
. mrratio 1 .5 1 .25, fieller eform

exp() ratio estimate: 2.7182818
95% Fieller CI: [1.0201699, 13.625268]

. assert e(fiellerres) == 1

. assert _b[beta] == 1

. assert abs(e(lowerci) - .019969) < 1e-6

. assert abs(e(upperci) - 2.611925) < 1e-6

. 
. mrratio 1 .5 1 .25, fieller level(90)

Ratio estimate: 1
90% Fieller CI: [.1744505, 2.232568]

. assert e(level) == 90

. 
. // nome
. mrratio 1 .5 1 .25, nome

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1         .5     2.00   0.046      .020018    1.979982
------------------------------------------------------------------------------

. assert e(fiellerres) == .

. assert _b[beta] == 1

. assert _se[beta] == .5

. mat li r(table)

r(table)[9,1]
             beta
     b          1
    se         .5
     z          2
pvalue  .04550026
    ll  .02001801
    ul   1.979982
    df          .
  crit   1.959964
 eform          0

. mrratio

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1         .5     2.00   0.046      .020018    1.979982
------------------------------------------------------------------------------

. mrratio, level(90)

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [90% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1         .5     2.00   0.046     .1775732    1.822427
------------------------------------------------------------------------------

. mrratio 1 .5 1 .25, nome eform

------------------------------------------------------------------------------
             |      exp()   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |   2.718282   1.359141     2.00   0.046      1.02022    7.242613
------------------------------------------------------------------------------

. 
. rcof "noi mrratio 1 .5 1 .25, nome fieller" == 198
fieller and nome options may not be specified together

. 
. // fiellerres = 2
. mrratio 1 .0007 2000 10000, fieller

Ratio estimate: .0005
95% Fieller CI is the union of two open intervals: (-Inf, -.0000568], [.0000463
> , +Inf)

. assert e(fiellerres) == 2

. assert abs(e(lowerci) - -.0000568) < 1e-7

. assert abs(e(upperci) - .0000462) < 1e-7

. mrratio

Ratio estimate: .0005
95% Fieller CI is the union of two open intervals: (-Inf, -.00005682], [.000046
> 3, +Inf)

. 
. mrratio 1 .0007 2000 10000, fieller eform

exp() ratio estimate: 1.0005001
95% Fieller CI is the union of two open intervals: (-Inf, .9999432], [1.0000463
> , +Inf)

. assert e(fiellerres) == 2

. 
. // fiellerres = 3
. mrratio .0007 10000 2000 10000, fieller

Ratio estimate: 3.500e-07
Using Fieller's Theorem, no finite confidence interval exists
other than the entire real line.

. assert e(fiellerres) == 3

. assert _b[beta] == 3.5e-7

. mrratio

Ratio estimate: 3.500e-07
Using Fieller's Theorem, no finite confidence interval exists
other than the entire real line.

. 
. // allow 3 inputs but require nome
. mrratio 1 .5 1, nome

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1         .5     2.00   0.046      .020018    1.979982
------------------------------------------------------------------------------

. assert _b[beta] == 1

. 
. rcof "noi mrratio 1 .5 1" == 198
With 3 inputs please specify the nome option.

. 
. mrratio 1 .5 1 .25

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |          1    .559017     1.79   0.074    -.0956532    2.095653
------------------------------------------------------------------------------

. 
end of do-file
      name:  mrratio
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\mrratio.log
  log type:  text
 closed on:  27 Jun 2020, 23:09:42
-------------------------------------------------------------------------------

. 
. log close _all
      name:  master
       log:  C:\Users\tom\Documents\GitHub\mrrobust\cscripts\master.log
  log type:  text
 closed on:  27 Jun 2020, 23:09:42
-------------------------------------------------------------------------------
